<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>
		无常是常
	</title>
	<meta name="description" content="">
	<link rel="shortcut icon" href="/img/favicon.ico">

	<!-- Tailwind CSS -->
	
<link rel="stylesheet" href="/css/main.css">


		<!-- Dark Mode Script -->
		<script>
			// 深色模式初始化
			if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
				document.documentElement.classList.add('dark')
			} else {
				document.documentElement.classList.remove('dark')
			}

			// 深色模式切换函数
			function toggleDarkMode() {
				if (document.documentElement.classList.contains('dark')) {
					document.documentElement.classList.remove('dark')
					localStorage.theme = 'light'
				} else {
					document.documentElement.classList.add('dark')
					localStorage.theme = 'dark'
				}
			}

			// 搜索功能
			function performSearch() {
				const query = document.getElementById('search-input').value.toLowerCase();
				const resultsContainer = document.getElementById('search-results');
				const loadingElement = document.getElementById('search-loading');
				const emptyElement = document.getElementById('search-empty');

				if (!query.trim()) {
					resultsContainer.innerHTML = '';
					emptyElement.classList.add('hidden');
					return;
				}

				loadingElement.classList.remove('hidden');
				emptyElement.classList.add('hidden');

				// 模拟搜索延迟
				setTimeout(() => {
					fetch('/search.json')
						.then(response => response.json())
						.then(data => {
							const results = data.filter(post =>
								post.title.toLowerCase().includes(query) ||
								post.content.toLowerCase().includes(query) ||
								(post.tags && post.tags.some(tag => tag.toLowerCase().includes(query)))
							);

							loadingElement.classList.add('hidden');

							if (results.length === 0) {
								emptyElement.classList.remove('hidden');
								resultsContainer.innerHTML = '';
							} else {
								emptyElement.classList.add('hidden');
								displaySearchResults(results, query);
							}
						})
						.catch(error => {
							console.error('搜索出错:', error);
							loadingElement.classList.add('hidden');
							emptyElement.classList.remove('hidden');
						});
				}, 300);
			}

			function displaySearchResults(results, query) {
				const resultsContainer = document.getElementById('search-results');
				resultsContainer.innerHTML = results.map(post => {
					const highlightedTitle = highlightText(post.title, query);
					const excerpt = getExcerpt(post.content, query);
					const highlightedExcerpt = highlightText(excerpt, query);

					return `
					<article class="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 p-6 border border-gray-200 dark:border-gray-700">
						<h3 class="text-xl font-semibold mb-2">
							<a href="${post.url}" class="text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
								${highlightedTitle}
							</a>
						</h3>
						<p class="text-gray-600 dark:text-gray-300 mb-3 leading-relaxed">
							${highlightedExcerpt}
						</p>
						<div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
							<time datetime="${post.date}">${new Date(post.date).toLocaleDateString('zh-CN')}</time>
							${post.tags ? `<div class="flex gap-2">${post.tags.map(tag => `<span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full text-xs">${tag}</span>`).join('')}</div>` : ''}
						</div>
					</article>
				`;
				}).join('');
			}

			function highlightText(text, query) {
				if (!query) return text;
				const regex = new RegExp(`(${query})`, 'gi');
				return text.replace(regex, '<mark class="bg-yellow-200 dark:bg-yellow-800 px-1 rounded">$1</mark>');
			}

			function getExcerpt(content, query, maxLength = 200) {
				const queryIndex = content.toLowerCase().indexOf(query.toLowerCase());
				if (queryIndex === -1) {
					return content.substring(0, maxLength) + (content.length > maxLength ? '...' : '');
				}

				const start = Math.max(0, queryIndex - 50);
				const end = Math.min(content.length, queryIndex + query.length + 150);
				let excerpt = content.substring(start, end);

				if (start > 0) excerpt = '...' + excerpt;
				if (end < content.length) excerpt = excerpt + '...';

				return excerpt;
			}
		</script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="无常是常" type="application/atom+xml">
</head>
    

        <body
            class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 category">
            <div class="flex flex-col">
                <!-- 头部导航 -->
                <header class="bg-white dark:bg-gray-800 shadow-md">
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="flex justify-between items-center h-16">
				<div class="flex-shrink-0">
					<a href="/" class="flex items-center">						
						
						<span class="ml-2 text-xl font-bold text-gray-900 dark:text-white">无常是常</span>
					</a>
				</div>
				<div class="hidden md:block">
					<nav class="ml-10 flex items-baseline space-x-4">
						
						<a href="/" 
							class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-md text-md font-medium">
							文章
						</a>
						
						<a href="/about" 
							class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-md text-md font-medium">
							关于
						</a>
						
					</nav>
				</div>

				<div class="flex items-center space-x-4">
					<!-- 搜索按钮 -->
					<a href="/search/" class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none transition-colors" title="搜索">
						<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>
					</a>
					
					<!-- 深色模式切换 -->
					<button id="theme-toggle" class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none transition-colors" title="切换主题">
						<span id="theme-toggle-dark-icon" class="hidden"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"></path></svg></span>
						<span id="theme-toggle-light-icon" class="hidden"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></span>
					</button>
					
					<!-- 移动端菜单按钮 -->
					<button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none transition-colors">
						<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg>
					</button>
				</div>
			</div>
			
			<!-- 移动端菜单 -->
			<div id="mobile-menu" class="hidden md:hidden">
				<div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 border-t border-gray-200 dark:border-gray-700">
					
					<a href="/" 
						class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white block px-3 py-2 rounded-md text-base font-medium">
						文章
					</a>
					
					<a href="/about" 
						class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white block px-3 py-2 rounded-md text-base font-medium">
						关于
					</a>
					
				</div>
			</div>
		</div>
	</div>
</header>

                    <!-- 主要内容区域 -->
                    <main class="flex-1">
                        <div class="mx-auto px-2 sm:px-6 lg:px-8 py-8 max-w-7xl">
                            <div class="main-layout flex flex-col lg:flex-row gap-8">
                                <!-- 主内容区 -->
                                <div class="main-content flex-1">
                                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 md:p-12 lg:p-16">
                                        <!-- Hero Section -->
<div class="bg-gradient-to-br from-primary-50 to-blue-50 dark:from-gray-800 dark:to-gray-900 -mx-4 -mt-4 mb-8 px-6 py-8 rounded-t-lg">
    <div class="text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">
            无常是常
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-300 mb-6 max-w-2xl mx-auto">
            分享技术见解、学习心得和生活感悟
        </p>
        <div class="flex justify-center space-x-4">
            <a href="/archives" class="btn btn-primary">
                浏览文章
            </a>
            <a href="/about" class="btn btn-secondary">
                了解更多
            </a>
        </div>
    </div>
</div>

<!-- 最新文章列表 -->
<div class="space-y-6">
    <div class="mb-6 flex items-center">
        <div class="w-1 h-8 bg-primary-600 mr-3"></div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
            最新文章
        </h2>
    </div>
    
    <div class="space-y-6">
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2020/05/13/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%98%AF%E4%BB%80%E4%B9%88/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                消息中间件是什么?
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-0">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <h3 id="1、了解消息中间件之前先了解一下什么是“同步”">1、了解消息中间件之前先了解一下什么是“同步”?</h3>
<p>通常业务系统直接的调用如下图所示:</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513184840.png" alt=""></p>
<p>假设系统A收到了一个请求，可能是用户通过浏览器或者APP发起的，这时候系统A收到请求后马上去调用系统B，然后系统B再把返回结果返回给系统A，系统A才能返回给用户。如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513185350.png" alt=""></p>
<p>以上就是所谓的**“同步”**调用。这个同步的意思就是各个系统联动都是同步依次进行的，一个系统先动，然后立马带动另外一个系统一起动，最后大家依次干完活以后再返回结果。</p>
<h3 id="2、如何依托消息中间件实现异步？">2、如何依托消息中间件实现异步？</h3>
<p>我们往系统A和系统B之间加入一个消息中间件，简称为“MQ”，也就是消息队列。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513191451.png" alt=""></p>
<p>加入消息队列之后如何通信呢？</p>
<p>其实就是系统A执行完逻辑后给MQ中发送一条消息，然后就直接把结果返回给用户了。</p>
<p><strong>（注：前提是系统A返回给用户的结果不依赖于系统B的返回结果。假设系统B为短信系统，系统A向MQ发送一条发送短信的消息指令，系统A并不关心短信是否立即发送，只要最终在有效的时间内发送成功就行了。）</strong></p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513192217.png" alt=""></p>
<p>如上图所示，系统B什么时候执行自己的任务呢？</p>
<p>这时候系统B根据自己的情况，可能是系统A投递消息到MQ之后的1秒内，也可能是1分钟之后，多长时间都有可能，不管多长时间，系统B肯定会从MQ里获取到一条属于自己的消息。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513192841.png" alt=""></p>
<h3 id="3、消息中间件到底有什么用？">3、消息中间件到底有什么用？</h3>
<p>假设系统A要调用系统B干一些事，然后系统A先执行一些操作，需要耗费20ms，接着系统B执行一些操作，需要200ms，所以总共需要220ms。如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513193519.png" alt=""></p>
<p>如果在系统A和系统中间加一个MQ呢？</p>
<p>系统A干完自己的事情耗时20ms，然后发一个消息到MQ耗时5ms，然后就直接返回结果给用户，总计耗时25ms。系统B从MQ中获取消息花费200ms和用户就没有关系了。所以用户只需等待25ms就收到结果了。如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513214345.png" alt=""></p>
<p>假设系统A调用系统B出现故障呢？因为系统A调用系统B肯定返回异常，此时系统A是不是也得返回异常给用户？而系统A是不是还要去处理这个异常？</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513214749.png" alt=""></p>
<p>这一切是因为系统A和系统B通过同步调用的模式耦合在一起，所以系统B一旦出现故障，很肯能影响系统A也有故障，而且系统A还得去关心系统B的故障，去处理对应的异常。</p>
<p>如果在系统A和系统B中间加一个消息中间件，系统A就不用关心系统B是否出现故障了，因为那是系统B自己的事，等系统B故障恢复以后，就继续执行它自己的事，此时就对系统A没任何影响了。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513215346.png" alt=""></p>
<p>为什么会有这样的效果呢？正式因为通过引入MQ，两个系统实现了异步化调用，也就实现了解耦，所以相互之间并没有任何影响。</p>
<h3 id="5、流量削峰">5、流量削峰</h3>
<p>假设系统A是不操作数据库的，因此只要多部署几台机器，就可以抗下每秒1万的请求，比如部署个20台机器，就可以轻松抗下每秒上万请求。</p>
<p>然后系统B是要操作一台数据库服务器的，那台数据库的上限是接收每秒6000请求，那么系统B无论部署多少台机器都没用，因为他依赖的数据库最多只能接收每秒6000请求。</p>
<p>如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513215857.png" alt=""></p>
<p>假设现在有1万的QPS请求到了系统A，由于系统A部署了20台机器，所以可以抗住1万QPS。然后系统A会瞬间把1万QPS转发给系统B，假设系统B也抗住了1万QPS，但是系统B对数据库发起了1万QPS的请求，数据库一定会瞬间被压垮。</p>
<p>所以这时如果引入MQ，就可以解决这个问题了。MQ这个技术抗高并发的能力远远高于数据库，同样的机器配置下，如果数据库可以抗每秒6000请求，MQ至少可以抗每秒几万请求。</p>
<p>为什么呢？因为数据库复杂啊，他要能够支持你执行复杂的SQL语句，支持事务等复杂的机制，支持你对数据进行增删改查，听着简单，其实是很复杂的！所以一般数据库单服务器也就支撑每秒几千的请求。</p>
<p>所以只要你引入一个MQ，那么就可以让系统A把每秒1万请求都作为消息直接发送到MQ里，MQ可以轻松抗下来这每秒1万请求。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513220548.png" alt=""></p>
<p>接着，系统B只要慢慢的从MQ里获取消息然后执行数据库读写操作即可，这个获取消息的速度是系统B自己可以控制的，所以系统B完全可以用一个比较低的速率获取消息然后写入数据库，保证对数据库的QPS不要超过他的极限值6000。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513221033.png" alt=""></p>
<p>这个时候因为系统A发送消息到MQ很快，系统B从MQ消费消息很慢，所以MQ里自然会积压一些消息，不过不要紧，MQ一般都是基于磁盘来存储消息的，所以适当积压一些消息是可以的。当系统A的高峰过去，每秒可能就恢复到1000 QPS了，此时系统b还是以每秒6000QPS的速度获取消息写入数据库，那么自然MQ里积压的消息就会慢慢被消化掉了。</p>
<p>所以这就是MQ进行流量削峰的效果，<strong>系统A发送过来的每秒1万请求是一个流量洪峰，然后MQ直接给扛下来了，都存储自己本地磁盘，这个过程就是流量削峰的过程，瞬间把一个洪峰给削下来了，让系统B后续慢慢获取消息来处理。</strong></p>
<h3 id="6、总结">6、总结</h3>
<p><strong>消息中间件的主要作用就是削峰解耦，提升系统的响应速度。</strong></p>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-0">
                                        <div class="post-content" data-content-type="full">
                                            <h3 id="1、了解消息中间件之前先了解一下什么是“同步”">1、了解消息中间件之前先了解一下什么是“同步”?</h3>
<p>通常业务系统直接的调用如下图所示:</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513184840.png" alt=""></p>
<p>假设系统A收到了一个请求，可能是用户通过浏览器或者APP发起的，这时候系统A收到请求后马上去调用系统B，然后系统B再把返回结果返回给系统A，系统A才能返回给用户。如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513185350.png" alt=""></p>
<p>以上就是所谓的**“同步”**调用。这个同步的意思就是各个系统联动都是同步依次进行的，一个系统先动，然后立马带动另外一个系统一起动，最后大家依次干完活以后再返回结果。</p>
<h3 id="2、如何依托消息中间件实现异步？">2、如何依托消息中间件实现异步？</h3>
<p>我们往系统A和系统B之间加入一个消息中间件，简称为“MQ”，也就是消息队列。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513191451.png" alt=""></p>
<p>加入消息队列之后如何通信呢？</p>
<p>其实就是系统A执行完逻辑后给MQ中发送一条消息，然后就直接把结果返回给用户了。</p>
<p><strong>（注：前提是系统A返回给用户的结果不依赖于系统B的返回结果。假设系统B为短信系统，系统A向MQ发送一条发送短信的消息指令，系统A并不关心短信是否立即发送，只要最终在有效的时间内发送成功就行了。）</strong></p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513192217.png" alt=""></p>
<p>如上图所示，系统B什么时候执行自己的任务呢？</p>
<p>这时候系统B根据自己的情况，可能是系统A投递消息到MQ之后的1秒内，也可能是1分钟之后，多长时间都有可能，不管多长时间，系统B肯定会从MQ里获取到一条属于自己的消息。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513192841.png" alt=""></p>
<h3 id="3、消息中间件到底有什么用？">3、消息中间件到底有什么用？</h3>
<p>假设系统A要调用系统B干一些事，然后系统A先执行一些操作，需要耗费20ms，接着系统B执行一些操作，需要200ms，所以总共需要220ms。如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513193519.png" alt=""></p>
<p>如果在系统A和系统中间加一个MQ呢？</p>
<p>系统A干完自己的事情耗时20ms，然后发一个消息到MQ耗时5ms，然后就直接返回结果给用户，总计耗时25ms。系统B从MQ中获取消息花费200ms和用户就没有关系了。所以用户只需等待25ms就收到结果了。如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513214345.png" alt=""></p>
<p>假设系统A调用系统B出现故障呢？因为系统A调用系统B肯定返回异常，此时系统A是不是也得返回异常给用户？而系统A是不是还要去处理这个异常？</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513214749.png" alt=""></p>
<p>这一切是因为系统A和系统B通过同步调用的模式耦合在一起，所以系统B一旦出现故障，很肯能影响系统A也有故障，而且系统A还得去关心系统B的故障，去处理对应的异常。</p>
<p>如果在系统A和系统B中间加一个消息中间件，系统A就不用关心系统B是否出现故障了，因为那是系统B自己的事，等系统B故障恢复以后，就继续执行它自己的事，此时就对系统A没任何影响了。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513215346.png" alt=""></p>
<p>为什么会有这样的效果呢？正式因为通过引入MQ，两个系统实现了异步化调用，也就实现了解耦，所以相互之间并没有任何影响。</p>
<h3 id="5、流量削峰">5、流量削峰</h3>
<p>假设系统A是不操作数据库的，因此只要多部署几台机器，就可以抗下每秒1万的请求，比如部署个20台机器，就可以轻松抗下每秒上万请求。</p>
<p>然后系统B是要操作一台数据库服务器的，那台数据库的上限是接收每秒6000请求，那么系统B无论部署多少台机器都没用，因为他依赖的数据库最多只能接收每秒6000请求。</p>
<p>如下图所示：</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513215857.png" alt=""></p>
<p>假设现在有1万的QPS请求到了系统A，由于系统A部署了20台机器，所以可以抗住1万QPS。然后系统A会瞬间把1万QPS转发给系统B，假设系统B也抗住了1万QPS，但是系统B对数据库发起了1万QPS的请求，数据库一定会瞬间被压垮。</p>
<p>所以这时如果引入MQ，就可以解决这个问题了。MQ这个技术抗高并发的能力远远高于数据库，同样的机器配置下，如果数据库可以抗每秒6000请求，MQ至少可以抗每秒几万请求。</p>
<p>为什么呢？因为数据库复杂啊，他要能够支持你执行复杂的SQL语句，支持事务等复杂的机制，支持你对数据进行增删改查，听着简单，其实是很复杂的！所以一般数据库单服务器也就支撑每秒几千的请求。</p>
<p>所以只要你引入一个MQ，那么就可以让系统A把每秒1万请求都作为消息直接发送到MQ里，MQ可以轻松抗下来这每秒1万请求。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513220548.png" alt=""></p>
<p>接着，系统B只要慢慢的从MQ里获取消息然后执行数据库读写操作即可，这个获取消息的速度是系统B自己可以控制的，所以系统B完全可以用一个比较低的速率获取消息然后写入数据库，保证对数据库的QPS不要超过他的极限值6000。</p>
<p><img src="http://qiniu.deveye.cn/blog/img/20210513221033.png" alt=""></p>
<p>这个时候因为系统A发送消息到MQ很快，系统B从MQ消费消息很慢，所以MQ里自然会积压一些消息，不过不要紧，MQ一般都是基于磁盘来存储消息的，所以适当积压一些消息是可以的。当系统A的高峰过去，每秒可能就恢复到1000 QPS了，此时系统b还是以每秒6000QPS的速度获取消息写入数据库，那么自然MQ里积压的消息就会慢慢被消化掉了。</p>
<p>所以这就是MQ进行流量削峰的效果，<strong>系统A发送过来的每秒1万请求是一个流量洪峰，然后MQ直接给扛下来了，都存储自己本地磁盘，这个过程就是流量削峰的过程，瞬间把一个洪峰给削下来了，让系统B后续慢慢获取消息来处理。</strong></p>
<h3 id="6、总结">6、总结</h3>
<p><strong>消息中间件的主要作用就是削峰解耦，提升系统的响应速度。</strong></p>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2020-05-13T06:59:34.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2020-05-13
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/RocketMQ/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                RocketMQ
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="0" id="btn-0">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2019/09/03/%E9%93%BE%E8%A1%A8/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                链表
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-1">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <h3 id="反转链表">反转链表</h3>
<p><img src="http://qiniu.deveye.cn/blog/img/20220302192225.gif" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	head := &amp;ListNode&#123;</span><br><span class="line">		1, &amp;ListNode&#123;</span><br><span class="line">			2, &amp;ListNode&#123;</span><br><span class="line">				3, &amp;ListNode&#123;</span><br><span class="line">					4, &amp;ListNode&#123;</span><br><span class="line">						5, nil&#125;&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	for list := reverseList(head); list != nil; list = list.Next &#123;</span><br><span class="line">		fmt.Println(list.Val)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type ListNode struct &#123;</span><br><span class="line">	Val  int</span><br><span class="line">	Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func reverseList(head *ListNode) *ListNode &#123;</span><br><span class="line">	var cur, prev *ListNode = head, nil</span><br><span class="line">	for cur != nil &#123;</span><br><span class="line">		cur.Next, prev, cur = prev, cur, cur.Next</span><br><span class="line">	&#125;</span><br><span class="line">	return prev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="交换相邻两个节点">交换相邻两个节点</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	head := &amp;ListNode&#123;</span><br><span class="line">		1, &amp;ListNode&#123;</span><br><span class="line">			2, &amp;ListNode&#123;</span><br><span class="line">				3, &amp;ListNode&#123;</span><br><span class="line">					4, nil&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	for list := swapPairs(head); list != nil; list = list.Next &#123;</span><br><span class="line">		fmt.Println(list.Val)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type ListNode struct &#123;</span><br><span class="line">	Val  int</span><br><span class="line">	Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func swapPairs(head *ListNode) *ListNode &#123;</span><br><span class="line">	if head == nil || head.Next == nil &#123;</span><br><span class="line">		return head</span><br><span class="line">	&#125;</span><br><span class="line">	newHead := head.Next</span><br><span class="line">	head.Next = swapPairs(newHead.Next)</span><br><span class="line">	newHead.Next = head</span><br><span class="line">	return newHead</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="判断链表是否有环">判断链表是否有环</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">	cycle := &amp;ListNode&#123;</span><br><span class="line">		2, &amp;ListNode&#123;</span><br><span class="line">			0, &amp;ListNode&#123;</span><br><span class="line">				-4, nil&#125;&#125;&#125;</span><br><span class="line">	cycle.Next.Next.Next = cycle</span><br><span class="line">	head := &amp;ListNode&#123;</span><br><span class="line">		3, cycle,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(hasCycle(head))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type ListNode struct &#123;</span><br><span class="line">	Val  int</span><br><span class="line">	Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func hasCycle(head *ListNode) bool &#123;</span><br><span class="line">	if head == nil || head.Next == nil &#123;</span><br><span class="line">		return false</span><br><span class="line">	&#125;</span><br><span class="line">	slow, fast := head, head</span><br><span class="line">	for fast != nil &amp;&amp; fast.Next != nil &#123;</span><br><span class="line">		slow, fast = slow.Next, fast.Next.Next</span><br><span class="line">		if slow == fast &#123;</span><br><span class="line">			return true</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-1">
                                        <div class="post-content" data-content-type="full">
                                            <h3 id="反转链表">反转链表</h3>
<p><img src="http://qiniu.deveye.cn/blog/img/20220302192225.gif" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	head := &amp;ListNode&#123;</span><br><span class="line">		1, &amp;ListNode&#123;</span><br><span class="line">			2, &amp;ListNode&#123;</span><br><span class="line">				3, &amp;ListNode&#123;</span><br><span class="line">					4, &amp;ListNode&#123;</span><br><span class="line">						5, nil&#125;&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	for list := reverseList(head); list != nil; list = list.Next &#123;</span><br><span class="line">		fmt.Println(list.Val)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type ListNode struct &#123;</span><br><span class="line">	Val  int</span><br><span class="line">	Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func reverseList(head *ListNode) *ListNode &#123;</span><br><span class="line">	var cur, prev *ListNode = head, nil</span><br><span class="line">	for cur != nil &#123;</span><br><span class="line">		cur.Next, prev, cur = prev, cur, cur.Next</span><br><span class="line">	&#125;</span><br><span class="line">	return prev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="交换相邻两个节点">交换相邻两个节点</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	head := &amp;ListNode&#123;</span><br><span class="line">		1, &amp;ListNode&#123;</span><br><span class="line">			2, &amp;ListNode&#123;</span><br><span class="line">				3, &amp;ListNode&#123;</span><br><span class="line">					4, nil&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	for list := swapPairs(head); list != nil; list = list.Next &#123;</span><br><span class="line">		fmt.Println(list.Val)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type ListNode struct &#123;</span><br><span class="line">	Val  int</span><br><span class="line">	Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func swapPairs(head *ListNode) *ListNode &#123;</span><br><span class="line">	if head == nil || head.Next == nil &#123;</span><br><span class="line">		return head</span><br><span class="line">	&#125;</span><br><span class="line">	newHead := head.Next</span><br><span class="line">	head.Next = swapPairs(newHead.Next)</span><br><span class="line">	newHead.Next = head</span><br><span class="line">	return newHead</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="判断链表是否有环">判断链表是否有环</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">	cycle := &amp;ListNode&#123;</span><br><span class="line">		2, &amp;ListNode&#123;</span><br><span class="line">			0, &amp;ListNode&#123;</span><br><span class="line">				-4, nil&#125;&#125;&#125;</span><br><span class="line">	cycle.Next.Next.Next = cycle</span><br><span class="line">	head := &amp;ListNode&#123;</span><br><span class="line">		3, cycle,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(hasCycle(head))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type ListNode struct &#123;</span><br><span class="line">	Val  int</span><br><span class="line">	Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func hasCycle(head *ListNode) bool &#123;</span><br><span class="line">	if head == nil || head.Next == nil &#123;</span><br><span class="line">		return false</span><br><span class="line">	&#125;</span><br><span class="line">	slow, fast := head, head</span><br><span class="line">	for fast != nil &amp;&amp; fast.Next != nil &#123;</span><br><span class="line">		slow, fast = slow.Next, fast.Next.Next</span><br><span class="line">		if slow == fast &#123;</span><br><span class="line">			return true</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2019-09-03T10:23:11.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2019-09-03
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/%E7%AE%97%E6%B3%95/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                算法
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="1" id="btn-1">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2019/09/03/%E7%AE%97%E6%B3%95%E4%B9%8B%E6%97%85/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                算法之旅
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-2">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <ul>
<li><a href="/2019/09/03/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">排序算法</a></li>
<li><a href="/2019/09/03/%E9%93%BE%E8%A1%A8/">链表</a></li>
</ul>

                                        </div>
                                    </div>
                                    
                                </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2019-09-03T09:33:14.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2019-09-03
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/%E7%AE%97%E6%B3%95/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                算法
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <a href="/2019/09/03/%E7%AE%97%E6%B3%95%E4%B9%8B%E6%97%85/" class="hidden md:flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors">
                                    阅读更多
                                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg>
                                </a>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2019/09/03/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                排序算法
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-3">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <h3 id="排序算法">排序算法</h3>
<h4 id="冒泡排序">冒泡排序</h4>
<p>双层循环,每次循环将最大的值放到数组的最后面,外层循环n次,内层循环n-i次完成排序,时间复杂度为O(n²)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func bubbleSort(arr []int) &#123;</span><br><span class="line">	for i := 0; i &lt; len(arr)-1; i++ &#123;</span><br><span class="line">		for j := 0; j &lt; len(arr)-i-1; j++ &#123;</span><br><span class="line">			if arr[j] &gt; arr[j+1] &#123;</span><br><span class="line">				arr[j], arr[j+1] = arr[j+1], arr[j]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="选择排序">选择排序</h4>
<p>双层循环,每次循环找出arr[n-i]中最小的数与当前数进行交换,时间复杂度为O(n²)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func selectSort(arr []int) &#123;</span><br><span class="line">	for i := 0; i &lt; len(arr)-1; i++ &#123;</span><br><span class="line">		var min = i</span><br><span class="line">		for j := i + 1; j &lt; len(arr); j++ &#123;</span><br><span class="line">			if arr[min] &gt; arr[j] &#123;</span><br><span class="line">				min = j</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		arr[i], arr[min] = arr[min], arr[i]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="插入排序">插入排序</h4>
<p>双层循环,类似打扑克牌调整牌的顺序,每次循环对当前数字顺序进行插入调整,时间复杂度为O(n²)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func insertionSort(arr []int) &#123;</span><br><span class="line">	for i := range arr &#123;</span><br><span class="line">		preIndex := i - 1</span><br><span class="line">		current := arr[i]</span><br><span class="line">		for preIndex &gt;= 0 &amp;&amp; arr[preIndex] &gt; current &#123;</span><br><span class="line">			arr[preIndex+1] = arr[preIndex]</span><br><span class="line">			preIndex -= 1</span><br><span class="line">		&#125;</span><br><span class="line">		arr[preIndex+1] = current</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="归并排序">归并排序</h4>
<p>分治的思想,时间复杂度O(N*logN)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">func mergeSort(arr []int) []int &#123;</span><br><span class="line">	if len(arr) &lt; 2 &#123;</span><br><span class="line">		return arr</span><br><span class="line">	&#125;</span><br><span class="line">	i := len(arr) / 2</span><br><span class="line">	left := mergeSort(arr[:i])</span><br><span class="line">	right := mergeSort(arr[i:])</span><br><span class="line">	result := merge(left, right)</span><br><span class="line">	return result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func merge(left, right []int) []int &#123;</span><br><span class="line">	result := make([]int, 0)</span><br><span class="line">	m, n := 0, 0</span><br><span class="line">	l, r := len(left), len(right)</span><br><span class="line">	for m &lt; l &amp;&amp; n &lt; r &#123;</span><br><span class="line">		if left[m] &gt; right[n] &#123;</span><br><span class="line">			result = append(result, right[n])</span><br><span class="line">			n++</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			result = append(result, left[m])</span><br><span class="line">			m++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	result = append(result, right[n:]...)</span><br><span class="line">	result = append(result, left[m:]...)</span><br><span class="line">	return result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="堆排序">堆排序</h4>
<p><img src="http://qiniu.deveye.cn/blog/img/20220411162143.png" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package heap</span><br><span class="line"></span><br><span class="line">func sink(array []int, parentIndex int, length int) &#123;</span><br><span class="line">	//保存父节点，用于最后的赋值</span><br><span class="line">	temp := array[parentIndex]</span><br><span class="line">	//左子节点</span><br><span class="line">	childIndex := 2*parentIndex + 1</span><br><span class="line">	//是否有左子节点</span><br><span class="line">	for childIndex &lt; length &#123;</span><br><span class="line">		//判断是否有右子节点，并且右子节点大于左子节点的值</span><br><span class="line">		if childIndex+1 &lt; length &amp;&amp; array[childIndex+1] &gt; array[childIndex] &#123;</span><br><span class="line">			childIndex++</span><br><span class="line">		&#125;</span><br><span class="line">		//如果父节点大于任何一个子节点的值直接跳出</span><br><span class="line">		if temp &gt;= array[childIndex] &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125;</span><br><span class="line">		array[parentIndex] = array[childIndex]</span><br><span class="line">		parentIndex = childIndex</span><br><span class="line">		childIndex = 2*childIndex + 1</span><br><span class="line">	&#125;</span><br><span class="line">	array[parentIndex] = temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func heapSort(array []int) &#123;</span><br><span class="line">	//构建大顶堆</span><br><span class="line">	for i := (len(array) - 2) / 2; i &gt;= 0; i-- &#123;</span><br><span class="line">		sink(array, i, len(array))</span><br><span class="line">	&#125;</span><br><span class="line">	//将堆顶元素和最后一个元素交换，数组长度i--(相当于循环删除根顶部元素，然后sink 调整最大堆)</span><br><span class="line">	for i := len(array) - 1; i &gt; 0; i-- &#123;</span><br><span class="line">		array[i], array[0] = array[0], array[i]</span><br><span class="line">		sink(array, 0, i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-3">
                                        <div class="post-content" data-content-type="full">
                                            <h3 id="排序算法">排序算法</h3>
<h4 id="冒泡排序">冒泡排序</h4>
<p>双层循环,每次循环将最大的值放到数组的最后面,外层循环n次,内层循环n-i次完成排序,时间复杂度为O(n²)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func bubbleSort(arr []int) &#123;</span><br><span class="line">	for i := 0; i &lt; len(arr)-1; i++ &#123;</span><br><span class="line">		for j := 0; j &lt; len(arr)-i-1; j++ &#123;</span><br><span class="line">			if arr[j] &gt; arr[j+1] &#123;</span><br><span class="line">				arr[j], arr[j+1] = arr[j+1], arr[j]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="选择排序">选择排序</h4>
<p>双层循环,每次循环找出arr[n-i]中最小的数与当前数进行交换,时间复杂度为O(n²)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func selectSort(arr []int) &#123;</span><br><span class="line">	for i := 0; i &lt; len(arr)-1; i++ &#123;</span><br><span class="line">		var min = i</span><br><span class="line">		for j := i + 1; j &lt; len(arr); j++ &#123;</span><br><span class="line">			if arr[min] &gt; arr[j] &#123;</span><br><span class="line">				min = j</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		arr[i], arr[min] = arr[min], arr[i]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="插入排序">插入排序</h4>
<p>双层循环,类似打扑克牌调整牌的顺序,每次循环对当前数字顺序进行插入调整,时间复杂度为O(n²)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func insertionSort(arr []int) &#123;</span><br><span class="line">	for i := range arr &#123;</span><br><span class="line">		preIndex := i - 1</span><br><span class="line">		current := arr[i]</span><br><span class="line">		for preIndex &gt;= 0 &amp;&amp; arr[preIndex] &gt; current &#123;</span><br><span class="line">			arr[preIndex+1] = arr[preIndex]</span><br><span class="line">			preIndex -= 1</span><br><span class="line">		&#125;</span><br><span class="line">		arr[preIndex+1] = current</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="归并排序">归并排序</h4>
<p>分治的思想,时间复杂度O(N*logN)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">func mergeSort(arr []int) []int &#123;</span><br><span class="line">	if len(arr) &lt; 2 &#123;</span><br><span class="line">		return arr</span><br><span class="line">	&#125;</span><br><span class="line">	i := len(arr) / 2</span><br><span class="line">	left := mergeSort(arr[:i])</span><br><span class="line">	right := mergeSort(arr[i:])</span><br><span class="line">	result := merge(left, right)</span><br><span class="line">	return result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func merge(left, right []int) []int &#123;</span><br><span class="line">	result := make([]int, 0)</span><br><span class="line">	m, n := 0, 0</span><br><span class="line">	l, r := len(left), len(right)</span><br><span class="line">	for m &lt; l &amp;&amp; n &lt; r &#123;</span><br><span class="line">		if left[m] &gt; right[n] &#123;</span><br><span class="line">			result = append(result, right[n])</span><br><span class="line">			n++</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			result = append(result, left[m])</span><br><span class="line">			m++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	result = append(result, right[n:]...)</span><br><span class="line">	result = append(result, left[m:]...)</span><br><span class="line">	return result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="堆排序">堆排序</h4>
<p><img src="http://qiniu.deveye.cn/blog/img/20220411162143.png" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package heap</span><br><span class="line"></span><br><span class="line">func sink(array []int, parentIndex int, length int) &#123;</span><br><span class="line">	//保存父节点，用于最后的赋值</span><br><span class="line">	temp := array[parentIndex]</span><br><span class="line">	//左子节点</span><br><span class="line">	childIndex := 2*parentIndex + 1</span><br><span class="line">	//是否有左子节点</span><br><span class="line">	for childIndex &lt; length &#123;</span><br><span class="line">		//判断是否有右子节点，并且右子节点大于左子节点的值</span><br><span class="line">		if childIndex+1 &lt; length &amp;&amp; array[childIndex+1] &gt; array[childIndex] &#123;</span><br><span class="line">			childIndex++</span><br><span class="line">		&#125;</span><br><span class="line">		//如果父节点大于任何一个子节点的值直接跳出</span><br><span class="line">		if temp &gt;= array[childIndex] &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125;</span><br><span class="line">		array[parentIndex] = array[childIndex]</span><br><span class="line">		parentIndex = childIndex</span><br><span class="line">		childIndex = 2*childIndex + 1</span><br><span class="line">	&#125;</span><br><span class="line">	array[parentIndex] = temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func heapSort(array []int) &#123;</span><br><span class="line">	//构建大顶堆</span><br><span class="line">	for i := (len(array) - 2) / 2; i &gt;= 0; i-- &#123;</span><br><span class="line">		sink(array, i, len(array))</span><br><span class="line">	&#125;</span><br><span class="line">	//将堆顶元素和最后一个元素交换，数组长度i--(相当于循环删除根顶部元素，然后sink 调整最大堆)</span><br><span class="line">	for i := len(array) - 1; i &gt; 0; i-- &#123;</span><br><span class="line">		array[i], array[0] = array[0], array[i]</span><br><span class="line">		sink(array, 0, i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2019-09-03T08:46:05.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2019-09-03
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/%E7%AE%97%E6%B3%95/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                算法
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="3" id="btn-3">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2019/08/14/GitCommitTemplate/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                一份建议的Git Commit 模版
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-4">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;类型&gt;: (类型的值见下面描述) &lt;主题&gt; (最多50个字)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>feat (新特性)<br>
fix (bug修复)<br>
docs (文档改动)<br>
style (格式化, 缺失分号等; 不包括生产代码变动)<br>
refactor (重构代码)<br>
test (添加缺失的测试, 重构测试, 不包括生产代码变动)<br>
chore (更新grunt任务等; 不包括生产代码变动)</p>
</blockquote>
<ul>
<li>主题和内容以一个空行分隔</li>
<li>主题限制为最大50个字</li>
<li>主题行大写</li>
<li>主题行结束不用标点</li>
<li>主题行使用祈使名</li>
<li>内容每行72个字</li>
<li>内容用于解释为什么和是什么,而不是怎么做</li>
<li>内容多行时以’-'分隔</li>
</ul>

                                        </div>
                                    </div>
                                    
                                </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2019-08-14T08:36:00.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2019-08-14
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/Git/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                Git
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <a href="/2019/08/14/GitCommitTemplate/" class="hidden md:flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors">
                                    阅读更多
                                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg>
                                </a>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2019/02/18/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                Git常用命令
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-5">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <p><img src="http://qiniu.deveye.cn/20210316200434.png" alt=""></p>
<h3 id="一、新建代码库">一、新建代码库</h3>
<blockquote>
<p><font color=gray># 在当前目录新建一个Git代码库</font><br>
$ git init</p>
<p><font color=gray># 新建一个目录，将其初始化为Git代码库</font><br>
$ git init [project-name]</p>
<p><font color=gray># 下载一个项目和它的整个代码历史</font><br>
$ git clone [url]</p>
</blockquote>
<h3 id="二、配置">二、配置</h3>
<p>Git的设置文件为.gitconfig，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）</p>
<blockquote>
<p><font color=gray># 显示当前的Git配置</font><br>
$ git config --list</p>
<p><font color=gray># 编辑Git配置文件</font><br>
$ git config -e [–global]</p>
<p><font color=gray># 设置提交代码时的用户信息</font><br>
$ git config [–global] <a href="http://user.name">user.name</a> &quot;[name]&quot;<br>
$ git config [–global] user.email &quot;[email   address]&quot;</p>
</blockquote>
<h3 id="三、增加-删除文件">三、增加/删除文件</h3>
<blockquote>
<p><font color=gray># 添加指定文件到暂存区</font><br>
$ git add [file1] [file2] …</p>
<p><font color=gray># 添加指定目录到暂存区，包括子目录</font><br>
$ git add [dir]</p>
<p><font color=gray># 添加当前目录的所有文件到暂存区</font><br>
$ git add .</p>
<p><font color=gray># 添加每个变化前，都会要求确认</font><br>
<font color=gray># 对于同一个文件的多处变化，可以实现分次提交</font><br>
$ git add -p</p>
<p><font color=gray># 删除工作区文件，并且将这次删除放入暂存区</font><br>
$ git rm [file1] [file2] …</p>
<p><font color=gray># 停止追踪指定文件，但该文件会保留在工作区</font><br>
$ git rm --cached [file]</p>
<p><font color=gray># 改名文件，并且将这个改名放入暂存区</font><br>
$ git mv [file-original] [file-renamed]</p>
</blockquote>
<h3 id="四、代码提交">四、代码提交</h3>
<blockquote>
<p><font color=gray># 提交暂存区到仓库区</font><br>
$ git commit -m [message]</p>
<p><font color=gray># 提交暂存区的指定文件到仓库区</font><br>
$ git commit [file1] [file2] … -m [message]</p>
<p><font color=gray># 提交工作区自上次commit之后的变化，直接到仓库区</font><br>
$ git commit -a</p>
<p><font color=gray># 提交时显示所有diff信息</font><br>
$ git commit -v</p>
<p><font color=gray># 使用一次新的commit，替代上一次提交</font><br>
<font color=gray># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</font><br>
$ git commit --amend -m [message]</p>
<p><font color=gray># 重做上一次commit，并包括指定文件的新变化</font><br>
$ git commit --amend [file1] [file2] …</p>
</blockquote>
<h3 id="五、分支">五、分支</h3>
<blockquote>
<p><font color=gray># 列出所有本地分支</font><br>
$ git branch</p>
<p><font color=gray># 列出所有远程分支</font><br>
$ git branch -r</p>
<p><font color=gray># 列出所有本地分支和远程分支</font><br>
$ git branch -a</p>
<p><font color=gray># 新建一个分支，但依然停留在当前分支</font><br>
$ git branch [branch-name]</p>
<p><font color=gray># 新建一个分支，并切换到该分支</font><br>
$ git checkout -b [branch]</p>
<p><font color=gray># 新建一个分支，指向指定commit</font><br>
$ git branch [branch] [commit]</p>
<p><font color=gray># 新建一个分支，与指定的远程分支建立追踪关系</font><br>
$ git branch --track [branch] [remote-branch]</p>
<p><font color=gray># 切换到指定分支，并更新工作区</font><br>
$ git checkout [branch-name]</p>
<p><font color=gray># 切换到上一个分支</font><br>
$ git checkout -</p>
<p><font color=gray># 建立追踪关系，在现有分支与指定的远程分支之间</font><br>
$ git branch --set-upstream [branch] [remote-branch]</p>
<p><font color=gray># 合并指定分支到当前分支</font><br>
$ git merge [branch]</p>
<p><font color=gray># 选择一个commit，合并进当前分支</font><br>
$ git cherry-pick [commit]</p>
<p><font color=gray># 删除分支</font><br>
$ git branch -d [branch-name]</p>
<p><font color=gray># 删除远程分支</font><br>
$ git push origin --delete [branch-name]<br>
$ git branch -dr [remote/branch]</p>
</blockquote>
<h3 id="六、标签">六、标签</h3>
<blockquote>
<p><font color=gray># 列出所有tag</font><br>
$ git tag</p>
<p><font color=gray># 新建一个tag在当前commit</font><br>
$ git tag [tag]</p>
<p><font color=gray># 新建一个tag在指定commit</font><br>
$ git tag [tag] [commit]</p>
<p><font color=gray># 删除本地tag</font><br>
$ git tag -d [tag]</p>
<p><font color=gray># 删除远程tag</font><br>
$ git push origin :refs/tags/[tagName]</p>
<p><font color=gray># 查看tag信息</font><br>
$ git show [tag]</p>
<p><font color=gray># 提交指定tag</font><br>
$ git push [remote] [tag]</p>
<p><font color=gray># 提交所有tag</font><br>
$ git push [remote] --tags</p>
<p><font color=gray># 新建一个分支，指向某个tag</font><br>
$ git checkout -b [branch] [tag]</p>
</blockquote>
<h3 id="七、查看信息">七、查看信息</h3>
<blockquote>
<p><font color=gray># 显示有变更的文件</font><br>
$ git status</p>
<p><font color=gray># 显示当前分支的版本历史</font><br>
$ git log</p>
<p><font color=gray># 显示commit历史，以及每次commit发生变更的文件</font><br>
$ git log --stat</p>
<p><font color=gray># 搜索提交历史，根据关键词</font><br>
$ git log -S [keyword]</p>
<p><font color=gray># 显示某个commit之后的所有变动，每个commit占据一行</font><br>
$ git log [tag] HEAD --pretty=format:%s</p>
<p><font color=gray># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</font><br>
$ git log [tag] HEAD --grep feature</p>
<p><font color=gray># 显示某个文件的版本历史，包括文件改名</font><br>
$ git log --follow [file]<br>
$ git whatchanged [file]</p>
<p><font color=gray># 显示指定文件相关的每一次diff</font><br>
$ git log -p [file]</p>
<p><font color=gray># 显示过去5次提交</font><br>
$ git log -5 --pretty --oneline</p>
<p><font color=gray># 显示所有提交过的用户，按提交次数排序</font><br>
$ git shortlog -sn</p>
<p><font color=gray># 显示指定文件是什么人在什么时间修改过</font><br>
$ git blame [file]</p>
<p><font color=gray># 显示暂存区和工作区的代码差异</font><br>
$ git diff</p>
<p><font color=gray># 显示暂存区和上一个commit的差异</font><br>
$ git diff --cached [file]</p>
<p><font color=gray># 显示工作区与当前分支最新commit之间的差异</font><br>
$ git diff HEAD</p>
<p><font color=gray># 显示两次提交之间的差异</font><br>
$ git diff [first-branch]…[second-branch]</p>
<p><font color=gray># 显示今天你写了多少行代码</font><br>
$ git diff --shortstat &quot;@{0 day ago}&quot;</p>
<p><font color=gray># 显示某次提交的元数据和内容变化</font><br>
$ git show [commit]</p>
<p><font color=gray># 显示某次提交发生变化的文件</font><br>
$ git show --name-only [commit]</p>
<p><font color=gray># 显示某次提交时，某个文件的内容</font><br>
$ git show [commit]:[filename]</p>
<p><font color=gray># 显示当前分支的最近几次提交</font><br>
$ git reflog</p>
<p><font color=gray># 从本地master拉取代码更新当前分支：branch 一般为master</font><br>
$ git rebase [branch]</p>
</blockquote>
<h3 id="八、远程同步">八、远程同步</h3>
<blockquote>
<p>$ git remote update  --更新远程仓储<br>
<font color=gray># 下载远程仓库的所有变动</font><br>
$ git fetch [remote]</p>
<p><font color=gray># 显示所有远程仓库</font><br>
$ git remote -v</p>
<p><font color=gray># 显示某个远程仓库的信息</font><br>
$ git remote show [remote]</p>
<p><font color=gray># 增加一个新的远程仓库，并命名</font><br>
$ git remote add [shortname] [url]</p>
<p><font color=gray># 取回远程仓库的变化，并与本地分支合并</font><br>
$ git pull [remote] [branch]</p>
<p><font color=gray># 上传本地指定分支到远程仓库</font><br>
$ git push [remote] [branch]</p>
<p><font color=gray># 强行推送当前分支到远程仓库，即使有冲突</font><br>
$ git push [remote] --force</p>
<p><font color=gray># 推送所有分支到远程仓库</font><br>
$ git push [remote] --all</p>
</blockquote>
<h3 id="九、撤销">九、撤销</h3>
<blockquote>
<p><font color=gray># 恢复暂存区的指定文件到工作区</font><br>
$ git checkout [file]</p>
<p><font color=gray># 恢复某个commit的指定文件到暂存区和工作区</font><br>
$ git checkout [commit] [file]</p>
<p><font color=gray># 恢复暂存区的所有文件到工作区</font><br>
$ git checkout .</p>
<p><font color=gray># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</font><br>
$ git reset [file]</p>
<p><font color=gray># 重置暂存区与工作区，与上一次commit保持一致</font><br>
$ git reset --hard</p>
<p><font color=gray># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</font><br>
$ git reset [commit]</p>
<p><font color=gray># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</font><br>
$ git reset --hard [commit]</p>
<p><font color=gray># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</font><br>
$ git reset --keep [commit]</p>
<p><font color=gray># 新建一个commit，用来撤销指定commit<br>
# 后者的所有变化都将被前者抵消，并且应用到当前分支</font><br>
$ git revert [commit]</p>
<p><font color=gray># 暂时将未提交的变化移除，稍后再移入</font><br>
$ git stash<br>
$ git stash pop</p>
</blockquote>
<h3 id="十、其他">十、其他</h3>
<blockquote>
<p><font color=gray># 生成一个可供发布的压缩包</font><br>
$ git archive</p>
</blockquote>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-5">
                                        <div class="post-content" data-content-type="full">
                                            <p><img src="http://qiniu.deveye.cn/20210316200434.png" alt=""></p>
<h3 id="一、新建代码库">一、新建代码库</h3>
<blockquote>
<p><font color=gray># 在当前目录新建一个Git代码库</font><br>
$ git init</p>
<p><font color=gray># 新建一个目录，将其初始化为Git代码库</font><br>
$ git init [project-name]</p>
<p><font color=gray># 下载一个项目和它的整个代码历史</font><br>
$ git clone [url]</p>
</blockquote>
<h3 id="二、配置">二、配置</h3>
<p>Git的设置文件为.gitconfig，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）</p>
<blockquote>
<p><font color=gray># 显示当前的Git配置</font><br>
$ git config --list</p>
<p><font color=gray># 编辑Git配置文件</font><br>
$ git config -e [–global]</p>
<p><font color=gray># 设置提交代码时的用户信息</font><br>
$ git config [–global] <a href="http://user.name">user.name</a> &quot;[name]&quot;<br>
$ git config [–global] user.email &quot;[email   address]&quot;</p>
</blockquote>
<h3 id="三、增加-删除文件">三、增加/删除文件</h3>
<blockquote>
<p><font color=gray># 添加指定文件到暂存区</font><br>
$ git add [file1] [file2] …</p>
<p><font color=gray># 添加指定目录到暂存区，包括子目录</font><br>
$ git add [dir]</p>
<p><font color=gray># 添加当前目录的所有文件到暂存区</font><br>
$ git add .</p>
<p><font color=gray># 添加每个变化前，都会要求确认</font><br>
<font color=gray># 对于同一个文件的多处变化，可以实现分次提交</font><br>
$ git add -p</p>
<p><font color=gray># 删除工作区文件，并且将这次删除放入暂存区</font><br>
$ git rm [file1] [file2] …</p>
<p><font color=gray># 停止追踪指定文件，但该文件会保留在工作区</font><br>
$ git rm --cached [file]</p>
<p><font color=gray># 改名文件，并且将这个改名放入暂存区</font><br>
$ git mv [file-original] [file-renamed]</p>
</blockquote>
<h3 id="四、代码提交">四、代码提交</h3>
<blockquote>
<p><font color=gray># 提交暂存区到仓库区</font><br>
$ git commit -m [message]</p>
<p><font color=gray># 提交暂存区的指定文件到仓库区</font><br>
$ git commit [file1] [file2] … -m [message]</p>
<p><font color=gray># 提交工作区自上次commit之后的变化，直接到仓库区</font><br>
$ git commit -a</p>
<p><font color=gray># 提交时显示所有diff信息</font><br>
$ git commit -v</p>
<p><font color=gray># 使用一次新的commit，替代上一次提交</font><br>
<font color=gray># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</font><br>
$ git commit --amend -m [message]</p>
<p><font color=gray># 重做上一次commit，并包括指定文件的新变化</font><br>
$ git commit --amend [file1] [file2] …</p>
</blockquote>
<h3 id="五、分支">五、分支</h3>
<blockquote>
<p><font color=gray># 列出所有本地分支</font><br>
$ git branch</p>
<p><font color=gray># 列出所有远程分支</font><br>
$ git branch -r</p>
<p><font color=gray># 列出所有本地分支和远程分支</font><br>
$ git branch -a</p>
<p><font color=gray># 新建一个分支，但依然停留在当前分支</font><br>
$ git branch [branch-name]</p>
<p><font color=gray># 新建一个分支，并切换到该分支</font><br>
$ git checkout -b [branch]</p>
<p><font color=gray># 新建一个分支，指向指定commit</font><br>
$ git branch [branch] [commit]</p>
<p><font color=gray># 新建一个分支，与指定的远程分支建立追踪关系</font><br>
$ git branch --track [branch] [remote-branch]</p>
<p><font color=gray># 切换到指定分支，并更新工作区</font><br>
$ git checkout [branch-name]</p>
<p><font color=gray># 切换到上一个分支</font><br>
$ git checkout -</p>
<p><font color=gray># 建立追踪关系，在现有分支与指定的远程分支之间</font><br>
$ git branch --set-upstream [branch] [remote-branch]</p>
<p><font color=gray># 合并指定分支到当前分支</font><br>
$ git merge [branch]</p>
<p><font color=gray># 选择一个commit，合并进当前分支</font><br>
$ git cherry-pick [commit]</p>
<p><font color=gray># 删除分支</font><br>
$ git branch -d [branch-name]</p>
<p><font color=gray># 删除远程分支</font><br>
$ git push origin --delete [branch-name]<br>
$ git branch -dr [remote/branch]</p>
</blockquote>
<h3 id="六、标签">六、标签</h3>
<blockquote>
<p><font color=gray># 列出所有tag</font><br>
$ git tag</p>
<p><font color=gray># 新建一个tag在当前commit</font><br>
$ git tag [tag]</p>
<p><font color=gray># 新建一个tag在指定commit</font><br>
$ git tag [tag] [commit]</p>
<p><font color=gray># 删除本地tag</font><br>
$ git tag -d [tag]</p>
<p><font color=gray># 删除远程tag</font><br>
$ git push origin :refs/tags/[tagName]</p>
<p><font color=gray># 查看tag信息</font><br>
$ git show [tag]</p>
<p><font color=gray># 提交指定tag</font><br>
$ git push [remote] [tag]</p>
<p><font color=gray># 提交所有tag</font><br>
$ git push [remote] --tags</p>
<p><font color=gray># 新建一个分支，指向某个tag</font><br>
$ git checkout -b [branch] [tag]</p>
</blockquote>
<h3 id="七、查看信息">七、查看信息</h3>
<blockquote>
<p><font color=gray># 显示有变更的文件</font><br>
$ git status</p>
<p><font color=gray># 显示当前分支的版本历史</font><br>
$ git log</p>
<p><font color=gray># 显示commit历史，以及每次commit发生变更的文件</font><br>
$ git log --stat</p>
<p><font color=gray># 搜索提交历史，根据关键词</font><br>
$ git log -S [keyword]</p>
<p><font color=gray># 显示某个commit之后的所有变动，每个commit占据一行</font><br>
$ git log [tag] HEAD --pretty=format:%s</p>
<p><font color=gray># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</font><br>
$ git log [tag] HEAD --grep feature</p>
<p><font color=gray># 显示某个文件的版本历史，包括文件改名</font><br>
$ git log --follow [file]<br>
$ git whatchanged [file]</p>
<p><font color=gray># 显示指定文件相关的每一次diff</font><br>
$ git log -p [file]</p>
<p><font color=gray># 显示过去5次提交</font><br>
$ git log -5 --pretty --oneline</p>
<p><font color=gray># 显示所有提交过的用户，按提交次数排序</font><br>
$ git shortlog -sn</p>
<p><font color=gray># 显示指定文件是什么人在什么时间修改过</font><br>
$ git blame [file]</p>
<p><font color=gray># 显示暂存区和工作区的代码差异</font><br>
$ git diff</p>
<p><font color=gray># 显示暂存区和上一个commit的差异</font><br>
$ git diff --cached [file]</p>
<p><font color=gray># 显示工作区与当前分支最新commit之间的差异</font><br>
$ git diff HEAD</p>
<p><font color=gray># 显示两次提交之间的差异</font><br>
$ git diff [first-branch]…[second-branch]</p>
<p><font color=gray># 显示今天你写了多少行代码</font><br>
$ git diff --shortstat &quot;@{0 day ago}&quot;</p>
<p><font color=gray># 显示某次提交的元数据和内容变化</font><br>
$ git show [commit]</p>
<p><font color=gray># 显示某次提交发生变化的文件</font><br>
$ git show --name-only [commit]</p>
<p><font color=gray># 显示某次提交时，某个文件的内容</font><br>
$ git show [commit]:[filename]</p>
<p><font color=gray># 显示当前分支的最近几次提交</font><br>
$ git reflog</p>
<p><font color=gray># 从本地master拉取代码更新当前分支：branch 一般为master</font><br>
$ git rebase [branch]</p>
</blockquote>
<h3 id="八、远程同步">八、远程同步</h3>
<blockquote>
<p>$ git remote update  --更新远程仓储<br>
<font color=gray># 下载远程仓库的所有变动</font><br>
$ git fetch [remote]</p>
<p><font color=gray># 显示所有远程仓库</font><br>
$ git remote -v</p>
<p><font color=gray># 显示某个远程仓库的信息</font><br>
$ git remote show [remote]</p>
<p><font color=gray># 增加一个新的远程仓库，并命名</font><br>
$ git remote add [shortname] [url]</p>
<p><font color=gray># 取回远程仓库的变化，并与本地分支合并</font><br>
$ git pull [remote] [branch]</p>
<p><font color=gray># 上传本地指定分支到远程仓库</font><br>
$ git push [remote] [branch]</p>
<p><font color=gray># 强行推送当前分支到远程仓库，即使有冲突</font><br>
$ git push [remote] --force</p>
<p><font color=gray># 推送所有分支到远程仓库</font><br>
$ git push [remote] --all</p>
</blockquote>
<h3 id="九、撤销">九、撤销</h3>
<blockquote>
<p><font color=gray># 恢复暂存区的指定文件到工作区</font><br>
$ git checkout [file]</p>
<p><font color=gray># 恢复某个commit的指定文件到暂存区和工作区</font><br>
$ git checkout [commit] [file]</p>
<p><font color=gray># 恢复暂存区的所有文件到工作区</font><br>
$ git checkout .</p>
<p><font color=gray># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</font><br>
$ git reset [file]</p>
<p><font color=gray># 重置暂存区与工作区，与上一次commit保持一致</font><br>
$ git reset --hard</p>
<p><font color=gray># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</font><br>
$ git reset [commit]</p>
<p><font color=gray># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</font><br>
$ git reset --hard [commit]</p>
<p><font color=gray># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</font><br>
$ git reset --keep [commit]</p>
<p><font color=gray># 新建一个commit，用来撤销指定commit<br>
# 后者的所有变化都将被前者抵消，并且应用到当前分支</font><br>
$ git revert [commit]</p>
<p><font color=gray># 暂时将未提交的变化移除，稍后再移入</font><br>
$ git stash<br>
$ git stash pop</p>
</blockquote>
<h3 id="十、其他">十、其他</h3>
<blockquote>
<p><font color=gray># 生成一个可供发布的压缩包</font><br>
$ git archive</p>
</blockquote>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2019-02-18T13:40:02.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2019-02-18
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/Git/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                Git
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="5" id="btn-5">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2019/01/18/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                Nginx基本配置
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-6">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <h3 id="1-Nginx-常用操作整理">1. Nginx 常用操作整理</h3>
<h4 id="1-1-启动-Nginx">1.1 启动 Nginx</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx</span><br></pre></td></tr></table></figure>
<h4 id="1-2-停止-Nginx">1.2 停止 Nginx</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -s stop</span><br><span class="line">./sbin/nginx -s quit</span><br><span class="line">-s 都是采用向 Nginx 发送信号的方式。</span><br></pre></td></tr></table></figure>
<h4 id="1-3-重载-Nginx">1.3 重载 Nginx</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -s reload</span><br></pre></td></tr></table></figure>
<h4 id="1-4-指定配置文件">1.4 指定配置文件</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<h4 id="1-5-配置语法检查">1.5 配置语法检查</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -t /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">常规用法： ./sbin/nginx -tc /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<h3 id="2-配置文件详解">2. 配置文件详解</h3>
<p>Nginx配置文件的分块下，基本就分为以下几块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">main # 全局设置</span><br><span class="line">events &#123; # Nginx工作模式</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line">http &#123; # http设置</span><br><span class="line">    ....</span><br><span class="line">    upstream myproject &#123; # 负载均衡服务器设置</span><br><span class="line">        .....</span><br><span class="line">    &#125;</span><br><span class="line">    server  &#123; # 主机设置</span><br><span class="line">        ....</span><br><span class="line">        location &#123; # URL匹配</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server  &#123;</span><br><span class="line">        ....</span><br><span class="line">        location &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-main模块">2.1 main模块</h4>
<p>下面是一个main区域，它是一个全局的设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user nobody nobody;</span><br><span class="line">worker_processes 2;</span><br><span class="line">error_log /usr/local/var/log/nginx/error.log notice;</span><br><span class="line">pid /usr/local/var/run/nginx/nginx.pid;</span><br><span class="line">worker_rlimit_nofile 1024;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>user 来指定Nginx Worker进程运行用户以及用户组，默认由nobody账号运行。</p>
<p>worker_processes 来指定了Nginx要开启的子进程数。每个Nginx进程平均耗费10M~12M内存。根据经验，一般指定1个进程就足够了，如果是多核CPU，建议指定和CPU的数量一样的进程数即可。我这里写2，那么就会开启2个子进程，总共3个进程。</p>
<p>error_log 来定义全局错误日志文件。日志输出级别有debug、info、notice、warn、error、crit可供选择，其中，debug输出日志最为最详细，而crit输出日志最少。</p>
<p>pid 来指定进程id的存储文件位置。</p>
<p>worker_rlimit_nofile 来指定一个nginx进程可以打开的最多文件描述符数目，这里是65535，需要使用命令“ulimit -n 65535”来设置。</p>
</blockquote>
<h4 id="2-2-events模块">2.2 events模块</h4>
<p>events模块来用指定nginx的工作模式和工作模式及连接数上限，一般是这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    use kqueue; #mac平台</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>use 用来指定Nginx的工作模式。Nginx支持的工作模式有select、poll、kqueue、epoll、rtsig和/dev/poll。其中select和poll都是标准的工作模式，kqueue和epoll是高效的工作模式，不同的是epoll用在Linux平台上，而kqueue用在BSD系统中，因为Mac基于BSD,所以Mac也得用这个模式，对于Linux系统，epoll工作模式是首选。</p>
<p>worker_connections 用于定义Nginx每个进程的最大连接数，即接收前端的最大请求数，默认是1024。最大客户端连接数由worker_processes和worker_connections决定，即Max_clients = worker_processes * worker_connections，在作为反向代理时，Max_clients变为：Max_clients = worker_processes * worker_connections / 4。</p>
<p>进程的最大连接数受Linux系统进程的最大打开文件数限制，在执行操作系统命令“ulimit -n 65536”后worker_connections的设置才能生效。</p>
</blockquote>
<h4 id="2-3-http模块">2.3 http模块</h4>
<p>http模块可以说是最核心的模块了，它负责HTTP服务器相关属性的配置，它里面的server和upstream子模块，至关重要，等到反向代理和负载均衡以及虚拟目录等会仔细说。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include mime.types;</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                    &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    access_log /usr/local/var/log/nginx/access.log  main;</span><br><span class="line">    sendfile on;</span><br><span class="line">    tcp_nopush on;</span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    keepalive_timeout 10;</span><br><span class="line">    #gzip on;</span><br><span class="line">    upstream myproject &#123;</span><br><span class="line">        .....</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-1-include">2.3.1 include</h5>
<blockquote>
<p>用来设定文件的mime类型,类型在配置文件目录下的mime.type文件定义，来告诉nginx来识别文件类型。</p>
</blockquote>
<h5 id="2-3-2-default-type">2.3.2 default_type</h5>
<blockquote>
<p>设定了默认的类型为二进制流，也就是当文件类型未定义时使用这种方式，例如在没有配置asp的locate 环境时，Nginx是不予解析的，此时，用浏览器访问asp文件就会出现下载窗口了。</p>
</blockquote>
<h5 id="2-3-3-log-format">2.3.3 log_format</h5>
<blockquote>
<p>用于设置日志的格式，和记录哪些参数，这里设置为main，刚好用于access_log来纪录这种类型。</p>
</blockquote>
<h5 id="2-3-4-access-log">2.3.4 access_log</h5>
<blockquote>
<p>用来纪录每次的访问日志的文件地址，后面的main是日志的格式样式，对应于log_format的main。</p>
</blockquote>
<h5 id="2-3-5-sendfile">2.3.5 sendfile</h5>
<blockquote>
<p>用于开启高效文件传输模式。将tcp_nopush和tcp_nodelay两个指令设置为on用于防止网络阻塞。</p>
</blockquote>
<h5 id="2-3-6-keepalive-timeout">2.3.6 keepalive_timeout</h5>
<blockquote>
<p>设置客户端连接保持活动的超时时间。在超过这个时间之后，服务器会关闭该连接。</p>
</blockquote>
<h4 id="6-4-server模块">6.4 server模块</h4>
<p>server模块是http的子模块，它用来定一个虚拟主机，我们先讲最基本的配置，这些在后面再讲。我们看一下一个简单的server是如何做的？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 8080;</span><br><span class="line">    server_name localhost 192.168.12.10 www.yangyi.com;</span><br><span class="line">    # 全局定义，如果都是这一个目录，这样定义最简单。</span><br><span class="line">    root   /Users/yangyi/www;</span><br><span class="line">    index  index.php index.html index.htm;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    access_log  usr/local/var/log/host.access.log  main;</span><br><span class="line">    error_log  usr/local/var/log/host.error.log  error;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>server 标志定义虚拟主机开始。</p>
<p>listen 用于指定虚拟主机的服务端口。</p>
<p>server_name 用来指定IP地址或者域名，多个域名之间用空格分开。</p>
<p>root 表示在这整个server虚拟主机内，全部的root web根目录。注意要和locate {}下面定义的区分开来。</p>
<p>index 全局定义访问的默认首页地址。注意要和locate {}下面定义的区分开来。</p>
<p>charset 用于设置网页的默认编码格式。</p>
<p>access_log 用来指定此虚拟主机的访问日志存放路径，最后的main用于指定访问日志的输出格式。</p>
</blockquote>
<h4 id="2-5-location模块">2.5 location模块</h4>
<p>location模块是nginx中用的最多的，也是最重要的模块了，什么负载均衡啊、反向代理啊、虚拟域名啊都与它相关。</p>
<p>location根据它字面意思就知道是来定位的，定位URL，解析URL，所以，它也提供了强大的正则匹配功能，也支持条件判断匹配，用户可以通过location指令实现Nginx对动、静态网页进行过滤处理。像我们的php环境搭建就是用到了它。</p>
<h5 id="2-5-1-我们先来看这个，设定默认首页和虚拟机目录">2.5.1 我们先来看这个，设定默认首页和虚拟机目录</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    root   /Users/yangyi/www;</span><br><span class="line">    index  index.php index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>location / 表示匹配访问根目录。</p>
<p>root 指令用于指定访问根目录时，虚拟主机的web目录，这个目录可以是相对路径（相对路径是相对于nginx的安装目录）。也可以是绝对路径。</p>
<p>index 用于设定我们只输入域名后访问的默认首页地址，有个先后顺序：index.php index.html index.htm，如果没有开启目录浏览权限，又找不到这些默认首页，就会报403错误。</p>
</blockquote>
<h5 id="2-5-2-location-还有一种方式就是正则匹配">2.5.2 location 还有一种方式就是正则匹配</h5>
<p>下面这个例子是运用正则匹配来链接php。我们之前搭建环境也是这样做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    root           /Users/yangyi/www;</span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    include        fastcgi.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>.php$ 熟悉正则的我们直到，这是匹配.php结尾的URL，用来解析php文件。里面的root也是一样，用来表示虚拟主机的根目录。<br>
fastcgi_pass 链接的是php-fpm的地址。其他几个参数我们以后再说。</p>
<p>location 还有其他用法，等讲到实例的时候，再看吧。</p>
</blockquote>
<h4 id="2-6-upstream模块">2.6 upstream模块</h4>
<p>upstream 模块负责负载均衡模块，通过一个简单的调度算法来实现客户端IP到后端服务器的负载均衡。先学习怎么用，具体的使用实例以后再说。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream deveye.cn&#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.12.1:80;</span><br><span class="line">    server 192.168.12.2:80 down;</span><br><span class="line">    server 192.168.12.3:8080  max_fails=3  fail_timeout=20s;</span><br><span class="line">    server 192.168.12.4:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，<a href="http://xn--upstreamiyangyi-7e3xouw5c9yc706c1jlfyemo5arx4bba4380k2ktarn6g3z2ap3oc8b41d.com">通过upstream指令指定了一个负载均衡器的名称iyangyi.com</a>。这个名称可以任意指定，在后面需要的地方直接调用即可。里面是ip_hash这是其中的一种负载均衡调度算法，下面会着重介绍。紧接着就是各种服务器了。用server关键字表识，后面接ip。<br>
<strong>Nginx的负载均衡模块目前支持4种调度算法：</strong></p>
<ol>
<li>
<p>weight 轮询（默认）。每个请求按时间顺序逐一分配到不同的后端服务器，如果后端某台服务器宕机，故障系统被自动剔除，使用户访问不受影响。weight，指定轮询权值，weight值越大，分配到的访问机率越高，主要用于后端每个服务器性能不均的情况下。</p>
</li>
<li>
<p>ip_hash。每个请求按访问IP的hash结果分配，这样来自同一个IP的访客固定访问一个后端服务器，有效解决了动态网页存在的session共享问题。</p>
</li>
<li>
<p>fair（第三方）。比上面两个更加智能的负载均衡算法。此种算法可以依据页面大小和加载时间长短智能地进行负载均衡，也就是根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身是不支持fair的，如果需要使用这种调度算法，必须下载Nginx的upstream_fair模块。</p>
</li>
<li>
<p>url_hash（第三方）。按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，可以进一步提高后端缓存服务器的效率。Nginx本身是不支持url_hash的，如果需要使用这种调度算法，必须安装Nginx的hash软件包。</p>
</li>
</ol>
<p>在HTTP Upstream模块中，可以通过server指令指定后端服务器的IP地址和端口，同时还可以设定每个后端服务器在负载均衡调度中的状态。常用的状态有：</p>
<ol>
<li>
<p>down，表示当前的server暂时不参与负载均衡。</p>
</li>
<li>
<p>backup，预留的备份机器。当其他所有的非backup机器出现故障或者忙的时候，才会请求backup机器，因此这台机器的压力最轻。</p>
</li>
<li>
<p>max_fails，允许请求失败的次数，默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误。</p>
</li>
<li>
<p>fail_timeout，在经历了max_fails次失败后，暂停服务的时间。max_fails可以和fail_timeout一起使用。</p>
</li>
</ol>
<p><em>注意：当负载调度算法为ip_hash时，后端服务器在负载均衡调度中的状态不能是weight和backup。</em></p>
<blockquote>
<p>转载自 ：<a href="https://www.jianshu.com/p/f04733896a48">https://www.jianshu.com/p/f04733896a48</a></p>
</blockquote>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-6">
                                        <div class="post-content" data-content-type="full">
                                            <h3 id="1-Nginx-常用操作整理">1. Nginx 常用操作整理</h3>
<h4 id="1-1-启动-Nginx">1.1 启动 Nginx</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx</span><br></pre></td></tr></table></figure>
<h4 id="1-2-停止-Nginx">1.2 停止 Nginx</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -s stop</span><br><span class="line">./sbin/nginx -s quit</span><br><span class="line">-s 都是采用向 Nginx 发送信号的方式。</span><br></pre></td></tr></table></figure>
<h4 id="1-3-重载-Nginx">1.3 重载 Nginx</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -s reload</span><br></pre></td></tr></table></figure>
<h4 id="1-4-指定配置文件">1.4 指定配置文件</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<h4 id="1-5-配置语法检查">1.5 配置语法检查</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx -t /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">常规用法： ./sbin/nginx -tc /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<h3 id="2-配置文件详解">2. 配置文件详解</h3>
<p>Nginx配置文件的分块下，基本就分为以下几块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">main # 全局设置</span><br><span class="line">events &#123; # Nginx工作模式</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line">http &#123; # http设置</span><br><span class="line">    ....</span><br><span class="line">    upstream myproject &#123; # 负载均衡服务器设置</span><br><span class="line">        .....</span><br><span class="line">    &#125;</span><br><span class="line">    server  &#123; # 主机设置</span><br><span class="line">        ....</span><br><span class="line">        location &#123; # URL匹配</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server  &#123;</span><br><span class="line">        ....</span><br><span class="line">        location &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-main模块">2.1 main模块</h4>
<p>下面是一个main区域，它是一个全局的设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user nobody nobody;</span><br><span class="line">worker_processes 2;</span><br><span class="line">error_log /usr/local/var/log/nginx/error.log notice;</span><br><span class="line">pid /usr/local/var/run/nginx/nginx.pid;</span><br><span class="line">worker_rlimit_nofile 1024;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>user 来指定Nginx Worker进程运行用户以及用户组，默认由nobody账号运行。</p>
<p>worker_processes 来指定了Nginx要开启的子进程数。每个Nginx进程平均耗费10M~12M内存。根据经验，一般指定1个进程就足够了，如果是多核CPU，建议指定和CPU的数量一样的进程数即可。我这里写2，那么就会开启2个子进程，总共3个进程。</p>
<p>error_log 来定义全局错误日志文件。日志输出级别有debug、info、notice、warn、error、crit可供选择，其中，debug输出日志最为最详细，而crit输出日志最少。</p>
<p>pid 来指定进程id的存储文件位置。</p>
<p>worker_rlimit_nofile 来指定一个nginx进程可以打开的最多文件描述符数目，这里是65535，需要使用命令“ulimit -n 65535”来设置。</p>
</blockquote>
<h4 id="2-2-events模块">2.2 events模块</h4>
<p>events模块来用指定nginx的工作模式和工作模式及连接数上限，一般是这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    use kqueue; #mac平台</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>use 用来指定Nginx的工作模式。Nginx支持的工作模式有select、poll、kqueue、epoll、rtsig和/dev/poll。其中select和poll都是标准的工作模式，kqueue和epoll是高效的工作模式，不同的是epoll用在Linux平台上，而kqueue用在BSD系统中，因为Mac基于BSD,所以Mac也得用这个模式，对于Linux系统，epoll工作模式是首选。</p>
<p>worker_connections 用于定义Nginx每个进程的最大连接数，即接收前端的最大请求数，默认是1024。最大客户端连接数由worker_processes和worker_connections决定，即Max_clients = worker_processes * worker_connections，在作为反向代理时，Max_clients变为：Max_clients = worker_processes * worker_connections / 4。</p>
<p>进程的最大连接数受Linux系统进程的最大打开文件数限制，在执行操作系统命令“ulimit -n 65536”后worker_connections的设置才能生效。</p>
</blockquote>
<h4 id="2-3-http模块">2.3 http模块</h4>
<p>http模块可以说是最核心的模块了，它负责HTTP服务器相关属性的配置，它里面的server和upstream子模块，至关重要，等到反向代理和负载均衡以及虚拟目录等会仔细说。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include mime.types;</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                    &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    access_log /usr/local/var/log/nginx/access.log  main;</span><br><span class="line">    sendfile on;</span><br><span class="line">    tcp_nopush on;</span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    keepalive_timeout 10;</span><br><span class="line">    #gzip on;</span><br><span class="line">    upstream myproject &#123;</span><br><span class="line">        .....</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-1-include">2.3.1 include</h5>
<blockquote>
<p>用来设定文件的mime类型,类型在配置文件目录下的mime.type文件定义，来告诉nginx来识别文件类型。</p>
</blockquote>
<h5 id="2-3-2-default-type">2.3.2 default_type</h5>
<blockquote>
<p>设定了默认的类型为二进制流，也就是当文件类型未定义时使用这种方式，例如在没有配置asp的locate 环境时，Nginx是不予解析的，此时，用浏览器访问asp文件就会出现下载窗口了。</p>
</blockquote>
<h5 id="2-3-3-log-format">2.3.3 log_format</h5>
<blockquote>
<p>用于设置日志的格式，和记录哪些参数，这里设置为main，刚好用于access_log来纪录这种类型。</p>
</blockquote>
<h5 id="2-3-4-access-log">2.3.4 access_log</h5>
<blockquote>
<p>用来纪录每次的访问日志的文件地址，后面的main是日志的格式样式，对应于log_format的main。</p>
</blockquote>
<h5 id="2-3-5-sendfile">2.3.5 sendfile</h5>
<blockquote>
<p>用于开启高效文件传输模式。将tcp_nopush和tcp_nodelay两个指令设置为on用于防止网络阻塞。</p>
</blockquote>
<h5 id="2-3-6-keepalive-timeout">2.3.6 keepalive_timeout</h5>
<blockquote>
<p>设置客户端连接保持活动的超时时间。在超过这个时间之后，服务器会关闭该连接。</p>
</blockquote>
<h4 id="6-4-server模块">6.4 server模块</h4>
<p>server模块是http的子模块，它用来定一个虚拟主机，我们先讲最基本的配置，这些在后面再讲。我们看一下一个简单的server是如何做的？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 8080;</span><br><span class="line">    server_name localhost 192.168.12.10 www.yangyi.com;</span><br><span class="line">    # 全局定义，如果都是这一个目录，这样定义最简单。</span><br><span class="line">    root   /Users/yangyi/www;</span><br><span class="line">    index  index.php index.html index.htm;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    access_log  usr/local/var/log/host.access.log  main;</span><br><span class="line">    error_log  usr/local/var/log/host.error.log  error;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>server 标志定义虚拟主机开始。</p>
<p>listen 用于指定虚拟主机的服务端口。</p>
<p>server_name 用来指定IP地址或者域名，多个域名之间用空格分开。</p>
<p>root 表示在这整个server虚拟主机内，全部的root web根目录。注意要和locate {}下面定义的区分开来。</p>
<p>index 全局定义访问的默认首页地址。注意要和locate {}下面定义的区分开来。</p>
<p>charset 用于设置网页的默认编码格式。</p>
<p>access_log 用来指定此虚拟主机的访问日志存放路径，最后的main用于指定访问日志的输出格式。</p>
</blockquote>
<h4 id="2-5-location模块">2.5 location模块</h4>
<p>location模块是nginx中用的最多的，也是最重要的模块了，什么负载均衡啊、反向代理啊、虚拟域名啊都与它相关。</p>
<p>location根据它字面意思就知道是来定位的，定位URL，解析URL，所以，它也提供了强大的正则匹配功能，也支持条件判断匹配，用户可以通过location指令实现Nginx对动、静态网页进行过滤处理。像我们的php环境搭建就是用到了它。</p>
<h5 id="2-5-1-我们先来看这个，设定默认首页和虚拟机目录">2.5.1 我们先来看这个，设定默认首页和虚拟机目录</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    root   /Users/yangyi/www;</span><br><span class="line">    index  index.php index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>location / 表示匹配访问根目录。</p>
<p>root 指令用于指定访问根目录时，虚拟主机的web目录，这个目录可以是相对路径（相对路径是相对于nginx的安装目录）。也可以是绝对路径。</p>
<p>index 用于设定我们只输入域名后访问的默认首页地址，有个先后顺序：index.php index.html index.htm，如果没有开启目录浏览权限，又找不到这些默认首页，就会报403错误。</p>
</blockquote>
<h5 id="2-5-2-location-还有一种方式就是正则匹配">2.5.2 location 还有一种方式就是正则匹配</h5>
<p>下面这个例子是运用正则匹配来链接php。我们之前搭建环境也是这样做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    root           /Users/yangyi/www;</span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    include        fastcgi.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>.php$ 熟悉正则的我们直到，这是匹配.php结尾的URL，用来解析php文件。里面的root也是一样，用来表示虚拟主机的根目录。<br>
fastcgi_pass 链接的是php-fpm的地址。其他几个参数我们以后再说。</p>
<p>location 还有其他用法，等讲到实例的时候，再看吧。</p>
</blockquote>
<h4 id="2-6-upstream模块">2.6 upstream模块</h4>
<p>upstream 模块负责负载均衡模块，通过一个简单的调度算法来实现客户端IP到后端服务器的负载均衡。先学习怎么用，具体的使用实例以后再说。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream deveye.cn&#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.12.1:80;</span><br><span class="line">    server 192.168.12.2:80 down;</span><br><span class="line">    server 192.168.12.3:8080  max_fails=3  fail_timeout=20s;</span><br><span class="line">    server 192.168.12.4:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，<a href="http://xn--upstreamiyangyi-7e3xouw5c9yc706c1jlfyemo5arx4bba4380k2ktarn6g3z2ap3oc8b41d.com">通过upstream指令指定了一个负载均衡器的名称iyangyi.com</a>。这个名称可以任意指定，在后面需要的地方直接调用即可。里面是ip_hash这是其中的一种负载均衡调度算法，下面会着重介绍。紧接着就是各种服务器了。用server关键字表识，后面接ip。<br>
<strong>Nginx的负载均衡模块目前支持4种调度算法：</strong></p>
<ol>
<li>
<p>weight 轮询（默认）。每个请求按时间顺序逐一分配到不同的后端服务器，如果后端某台服务器宕机，故障系统被自动剔除，使用户访问不受影响。weight，指定轮询权值，weight值越大，分配到的访问机率越高，主要用于后端每个服务器性能不均的情况下。</p>
</li>
<li>
<p>ip_hash。每个请求按访问IP的hash结果分配，这样来自同一个IP的访客固定访问一个后端服务器，有效解决了动态网页存在的session共享问题。</p>
</li>
<li>
<p>fair（第三方）。比上面两个更加智能的负载均衡算法。此种算法可以依据页面大小和加载时间长短智能地进行负载均衡，也就是根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身是不支持fair的，如果需要使用这种调度算法，必须下载Nginx的upstream_fair模块。</p>
</li>
<li>
<p>url_hash（第三方）。按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，可以进一步提高后端缓存服务器的效率。Nginx本身是不支持url_hash的，如果需要使用这种调度算法，必须安装Nginx的hash软件包。</p>
</li>
</ol>
<p>在HTTP Upstream模块中，可以通过server指令指定后端服务器的IP地址和端口，同时还可以设定每个后端服务器在负载均衡调度中的状态。常用的状态有：</p>
<ol>
<li>
<p>down，表示当前的server暂时不参与负载均衡。</p>
</li>
<li>
<p>backup，预留的备份机器。当其他所有的非backup机器出现故障或者忙的时候，才会请求backup机器，因此这台机器的压力最轻。</p>
</li>
<li>
<p>max_fails，允许请求失败的次数，默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误。</p>
</li>
<li>
<p>fail_timeout，在经历了max_fails次失败后，暂停服务的时间。max_fails可以和fail_timeout一起使用。</p>
</li>
</ol>
<p><em>注意：当负载调度算法为ip_hash时，后端服务器在负载均衡调度中的状态不能是weight和backup。</em></p>
<blockquote>
<p>转载自 ：<a href="https://www.jianshu.com/p/f04733896a48">https://www.jianshu.com/p/f04733896a48</a></p>
</blockquote>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2019-01-18T02:50:25.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2019-01-18
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/nginx/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                nginx
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="6" id="btn-6">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2018/07/07/Redis%E5%A4%8D%E5%88%B6/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                Redis复制
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-7">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <h3 id="Replication">Replication</h3>
<p>Redis使用主从复制非常简单，它允许从实例成为主实例的副本，每当链接断开时，从节点将自动重新连接到主服务器上。并且无论主服务器发生什么情况，从节点都尝试完全复制所有数据。</p>
<h3 id="Redis主从复制使用以下三种机制：">Redis主从复制使用以下三种机制：</h3>
<ul>
<li>当主从实例连接良好时，主节点向从节点发送<strong>命令流</strong>来进行更新，是为了复制由于Key过期或回收等其他操作对数据产生影响。</li>
<li>当主从实例断开时，从节点重新连接后只会尝试获取链接断开期间错开的命令流。</li>
<li>如果无法进行部分重新同步，则会要求完全重新同步。</li>
</ul>
<blockquote>
<p>默认情况下，Redis会使用<em><strong>异步复制</strong></em>，Redis从节点会异步地确认接收的数据。因此，主节点不会等待从节点处理完成。但是，如果需要知道从节点都处理了那些命令，也可以选择同步复制。</p>
</blockquote>
<h3 id="Redis-复制的几个特征：">Redis 复制的几个特征：</h3>
<ol>
<li>Redis是使用异步复制</li>
<li>一个主节点可以有多个从节点</li>
<li>从节点还可以有子节点，从Redis 4.0开始，所有子节点将从主节点接收完全相同的复制流。</li>
<li>Redis主从复制是无阻塞的，意味着在进行复制或同步是仍然可以进行数据查询</li>
<li>复制既可以用于可伸缩性，也可以用于只读查询的多个副本（读写分离）</li>
<li>可以配置主节点不进行数据保存或只启用AOF，然后将数据保存到副本，但是注意:当服务器重启后，从节点服务器重新同步数据时，同时会清空从节点数据。</li>
</ol>
<h3 id="Redis-复制的原理：">Redis 复制的原理：</h3>
<p>每个Redis Master 节点都有一个replication ID:这是一个较大的伪随机字符串，用于标记当前数据集。每个Master 还有一个偏移量，该偏移量会针对复制流中要发送到副本的每个字节的增量而增加。<br>
以便更新副本的状态。即使未连接任何副本，复制偏移也会增加。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=39.105.157.176,port=6379,state=online,offset=61238,lag=0</span><br><span class="line"># 主 Replication ID</span><br><span class="line">master_replid:649255ffb2183786d00203aa51715169b06f4f47</span><br><span class="line"># 副 Replication ID</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:61238</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:61238</span><br></pre></td></tr></table></figure>
<p>当从节点连接主节点时，会使用<code>PSYNC</code>命令来发送当前旧的主节点的Replication ID和offset，这样主节点只会同步相差的数据量，如果主节点缓冲区的副本引用（Replication ID）不存在，则会进行全量同步。</p>
<h4 id="全量同步的工作流程如下：">全量同步的工作流程如下：</h4>
<p>主节点开始后台生成RDB文件。同时，它开始缓冲从客户端收到的所有新写入命令。后台保存完成后，主数据库将数据库文件传输到从节点，从节点将其保存在磁盘上，然后将其加载到内存中。然后，主服务器将所有缓冲的命令发送到副本。</p>
<h3 id="Replication-ID-说明：">Replication ID 说明：</h3>
<p>如果两个实例具有相同的Replication ID和offset，则它们具有完全相同的数据。但是为什么会有两个Replication ID(主和副)？</p>
<p style="text-indent:2em">因为两个实例A和B具有相同的Replication ID，但一个实例的offset为1000，另一个实例的offset为1023，则意味着第一个实例缺少应用于数据集的某些命令。这也意味着，仅通过应用一些命令，A即可达到与B完全相同的状态。</p>
<p style="text-indent:2em">Redis实例具有两个Replication ID的原因是由于副本被提升为主副本。故障转移后，升级后的副本仍需要记住其过去的Replication ID，因为该Replication ID是以前的主副本之一。这样，当其他副本将与新的主副本同步时，它们将尝试使用旧的主Replication ID执行部分重新同步。因为将副本提升为主副本时，它会将其辅助ID设置为其主ID，并记住发生此ID切换时的offset。稍后它将选择一个新的随机Replication ID，因为新的历史记录开始了。处理新的副本连接时，主机将其ID和offset与当前ID和辅助ID相匹配（为安全起见，直到给定的偏移量）。简而言之，这意味着在故障转移后，连接到新提升的主服务器的副本不必执行完全同步。</p>
<h3 id="无盘复制">无盘复制</h3>
<p>通常，完全重新同步需要在磁盘上创建RDB文件，然后从磁盘重新加载相同的RDB，以便为副本提供数据。<br>
但是对于硬盘速度慢，但是在内网环境下，可以采用无盘复制，这样可以直接通过Socket将RDB发送给从节点，而无需使用硬盘作为中间存储。</p>
<h3 id="配置">配置</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof 192.168.1.1 6379</span><br></pre></td></tr></table></figure>
<p>也可以使用<code>REPLICAOF</code>命令进行同步。<br>
可以使用<code>repl-diskless-sync</code>配置参数启用无盘复制。在<code>repl-diskless-sync-delay </code>参数控制第一个副本之后，为了等待更多副本到达而开始传输的延迟。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth &lt;password&gt;</span><br></pre></td></tr></table></figure>
<p>设置主节点的密码，也可以使用redis-cli输入<code>config set masterauth &lt;password&gt;</code>进行设置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 在当前至少有N个副本连接到主服务器时才接受写查询</span><br><span class="line">min-replicas-to-write &lt;number of replicas&gt;</span><br><span class="line"># 在有N个副本延迟少于M秒时，则接受写入</span><br><span class="line">min-replicas-max-lag &lt;number of seconds&gt;</span><br></pre></td></tr></table></figure>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-7">
                                        <div class="post-content" data-content-type="full">
                                            <h3 id="Replication">Replication</h3>
<p>Redis使用主从复制非常简单，它允许从实例成为主实例的副本，每当链接断开时，从节点将自动重新连接到主服务器上。并且无论主服务器发生什么情况，从节点都尝试完全复制所有数据。</p>
<h3 id="Redis主从复制使用以下三种机制：">Redis主从复制使用以下三种机制：</h3>
<ul>
<li>当主从实例连接良好时，主节点向从节点发送<strong>命令流</strong>来进行更新，是为了复制由于Key过期或回收等其他操作对数据产生影响。</li>
<li>当主从实例断开时，从节点重新连接后只会尝试获取链接断开期间错开的命令流。</li>
<li>如果无法进行部分重新同步，则会要求完全重新同步。</li>
</ul>
<blockquote>
<p>默认情况下，Redis会使用<em><strong>异步复制</strong></em>，Redis从节点会异步地确认接收的数据。因此，主节点不会等待从节点处理完成。但是，如果需要知道从节点都处理了那些命令，也可以选择同步复制。</p>
</blockquote>
<h3 id="Redis-复制的几个特征：">Redis 复制的几个特征：</h3>
<ol>
<li>Redis是使用异步复制</li>
<li>一个主节点可以有多个从节点</li>
<li>从节点还可以有子节点，从Redis 4.0开始，所有子节点将从主节点接收完全相同的复制流。</li>
<li>Redis主从复制是无阻塞的，意味着在进行复制或同步是仍然可以进行数据查询</li>
<li>复制既可以用于可伸缩性，也可以用于只读查询的多个副本（读写分离）</li>
<li>可以配置主节点不进行数据保存或只启用AOF，然后将数据保存到副本，但是注意:当服务器重启后，从节点服务器重新同步数据时，同时会清空从节点数据。</li>
</ol>
<h3 id="Redis-复制的原理：">Redis 复制的原理：</h3>
<p>每个Redis Master 节点都有一个replication ID:这是一个较大的伪随机字符串，用于标记当前数据集。每个Master 还有一个偏移量，该偏移量会针对复制流中要发送到副本的每个字节的增量而增加。<br>
以便更新副本的状态。即使未连接任何副本，复制偏移也会增加。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=39.105.157.176,port=6379,state=online,offset=61238,lag=0</span><br><span class="line"># 主 Replication ID</span><br><span class="line">master_replid:649255ffb2183786d00203aa51715169b06f4f47</span><br><span class="line"># 副 Replication ID</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:61238</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:61238</span><br></pre></td></tr></table></figure>
<p>当从节点连接主节点时，会使用<code>PSYNC</code>命令来发送当前旧的主节点的Replication ID和offset，这样主节点只会同步相差的数据量，如果主节点缓冲区的副本引用（Replication ID）不存在，则会进行全量同步。</p>
<h4 id="全量同步的工作流程如下：">全量同步的工作流程如下：</h4>
<p>主节点开始后台生成RDB文件。同时，它开始缓冲从客户端收到的所有新写入命令。后台保存完成后，主数据库将数据库文件传输到从节点，从节点将其保存在磁盘上，然后将其加载到内存中。然后，主服务器将所有缓冲的命令发送到副本。</p>
<h3 id="Replication-ID-说明：">Replication ID 说明：</h3>
<p>如果两个实例具有相同的Replication ID和offset，则它们具有完全相同的数据。但是为什么会有两个Replication ID(主和副)？</p>
<p style="text-indent:2em">因为两个实例A和B具有相同的Replication ID，但一个实例的offset为1000，另一个实例的offset为1023，则意味着第一个实例缺少应用于数据集的某些命令。这也意味着，仅通过应用一些命令，A即可达到与B完全相同的状态。</p>
<p style="text-indent:2em">Redis实例具有两个Replication ID的原因是由于副本被提升为主副本。故障转移后，升级后的副本仍需要记住其过去的Replication ID，因为该Replication ID是以前的主副本之一。这样，当其他副本将与新的主副本同步时，它们将尝试使用旧的主Replication ID执行部分重新同步。因为将副本提升为主副本时，它会将其辅助ID设置为其主ID，并记住发生此ID切换时的offset。稍后它将选择一个新的随机Replication ID，因为新的历史记录开始了。处理新的副本连接时，主机将其ID和offset与当前ID和辅助ID相匹配（为安全起见，直到给定的偏移量）。简而言之，这意味着在故障转移后，连接到新提升的主服务器的副本不必执行完全同步。</p>
<h3 id="无盘复制">无盘复制</h3>
<p>通常，完全重新同步需要在磁盘上创建RDB文件，然后从磁盘重新加载相同的RDB，以便为副本提供数据。<br>
但是对于硬盘速度慢，但是在内网环境下，可以采用无盘复制，这样可以直接通过Socket将RDB发送给从节点，而无需使用硬盘作为中间存储。</p>
<h3 id="配置">配置</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof 192.168.1.1 6379</span><br></pre></td></tr></table></figure>
<p>也可以使用<code>REPLICAOF</code>命令进行同步。<br>
可以使用<code>repl-diskless-sync</code>配置参数启用无盘复制。在<code>repl-diskless-sync-delay </code>参数控制第一个副本之后，为了等待更多副本到达而开始传输的延迟。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth &lt;password&gt;</span><br></pre></td></tr></table></figure>
<p>设置主节点的密码，也可以使用redis-cli输入<code>config set masterauth &lt;password&gt;</code>进行设置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 在当前至少有N个副本连接到主服务器时才接受写查询</span><br><span class="line">min-replicas-to-write &lt;number of replicas&gt;</span><br><span class="line"># 在有N个副本延迟少于M秒时，则接受写入</span><br><span class="line">min-replicas-max-lag &lt;number of seconds&gt;</span><br></pre></td></tr></table></figure>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2018-07-07T01:04:12.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2018-07-07
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/Redis/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                Redis
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="7" id="btn-7">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2018/07/06/Redis%E6%8C%81%E4%B9%85%E5%8C%96/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                Redis持久化
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-8">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <h2 id="Redis的持久化机制-RDB">Redis的持久化机制-RDB</h2>
<h3 id="1-什么是RDB">1.什么是RDB</h3>
<p>The RDB persistence performs point-in-time snapshots of your dataset at specified intervals.(RDB持久化是以指定的时间间隔执行数据集的时间点快照。)<br>
简单来说，RDB是每隔一段时间，会把内存中的数据写入磁盘的临时文件作为快照，恢复时把快照文件读取到内存中。如果机器宕机，那么内存中的数据就会丢失，使用RDB机制后，重启后数据会恢复。</p>
<h3 id="2-备份与恢复">2.备份与恢复</h3>
<p>内存备份 --&gt; <font color="#e58484">磁盘临时文件</font><br>
临时文件 --&gt; <font color="#e58484">恢复到内存</font></p>
<h3 id="3-RDB优劣势">3.RDB优劣势</h3>
<ul>
<li>
<p><strong>优势</strong></p>
<ol>
<li>每隔一段时间全量备份</li>
<li>容灾简单，适合进行远程冷备份</li>
<li>子进程备份的时候，主进程不会有任何IO操作（不会有写入或修改），保证备份数据的完整性</li>
<li>相对AOF来说，当有更大的文件时候可以快速重启恢复</li>
</ol>
</li>
<li>
<p><strong>劣势</strong></p>
<ol>
<li>发生故障时，可能会丢失最后一次备份数据</li>
<li>子进程所占用的内存会和父进程一模一样，会造成CPU负担</li>
<li>由于定时全量备份是重量级操作，所以对于实时备份，就无法处理了</li>
</ol>
</li>
</ul>
<h3 id="4-RDB的配置">4.RDB的配置</h3>
<ol>
<li>保存位置可以自定义配置:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir /var/redis/6379/dump.rdb</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>保存机制</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#   900秒（15分钟）后，如果至少有 1 个Key发生改变</span><br><span class="line">#   300秒（5分钟）后，如果至少有 10 个Key发生改变</span><br><span class="line">#   60秒（1分钟）后，如果至少有 10000 个Key发生改变</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
<h2 id="Redis的持久化机制-AOF">Redis的持久化机制-AOF</h2>
<h3 id="1-什么是AOF">1.什么是AOF</h3>
<p>The AOF persistence logs every write operation received by the server, that will be played again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself, in an append-only fashion. Redis is able to rewrite the log in the background when it gets too big.</p>
<p>AOF持久化会记录服务器接收到的每个写入操作，这些操作将在服务器启动时再次执行，以重新构建原始的数据。命令记录的格式与Redis协议本身的格式相同，采用追加方式。当日志文件过大时，Redis可以在后台进行<code>rewrite</code>。</p>
<h3 id="2-备份与恢复-v2">2.备份与恢复</h3>
<p>日志备份 --&gt; <font color="#e58484">命令追加方式</font><br>
日志文件 --&gt; <font color="#e58484">根据命令日志文件重新构建</font></p>
<h3 id="3-AOF优劣势">3.AOF优劣势</h3>
<ul>
<li><strong>优势</strong>
<ol>
<li>使用AOF数据持久化更加完整</li>
<li>可以使用不同的fsync策略，使用默认策略fsync时，每秒的写入性能仍然很好（fsync是使用后台线程执行的，并且在没有进行fsync的情况下，主线程将尽力执行写入操作）但是会损失一秒的写入时间</li>
<li>AOF是使用日志追加的方式，如果断电或其他原因导致日志只写了一半，可以使用<code>redis-check-aof</code>工具进行修复</li>
<li>Redis太大时，Redis可以在后台自动重写AOF。 Redis继续追加到旧文件时，会生成一个新的文件，其中包含创建当前数据集<strong>所需的最少操作集</strong>，一旦准备好第二个文件，Redis会切换这两个文件并开始追加到新的那一个</li>
<li>即使使用<code>FLUSHALL</code>命令清空了所有数据，也可以通过修改AOF文件进行数据恢复</li>
</ol>
</li>
<li><strong>劣势</strong>
<ol>
<li>AOF相比RDB占用空间更大</li>
<li>使用fsync策略后，相比RDB性能差一些</li>
<li>当服务器宕机后，使用AOF恢复的数据可能不完整</li>
</ol>
</li>
</ul>
<h3 id="4-AOF的配置">4.AOF的配置</h3>
<ol>
<li>开启AOF</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>配置fsync策略</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># If unsure, use &quot;everysec&quot;.</span><br><span class="line"># 如果不确定，推荐使用 &quot;everysec&quot;</span><br><span class="line"></span><br><span class="line"># appendfsync always</span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync no</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>AOF rewrite配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 设置一个百分比</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"># 设置AOF 的最小大小</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Redis 启动加载配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 优先加载AOF 文件</span><br><span class="line">aof-use-rdb-preamble yes</span><br></pre></td></tr></table></figure>
<h2 id="两种持久化方式改如何选择">两种持久化方式改如何选择</h2>
<ul>
<li>如果对数据可靠性要求很高，则应同时使用两种持久性方式。</li>
<li>如果在灾难情况下仍然可以承受几分钟的数据丢失，则可以仅使用RDB。</li>
<li>不推荐单独使用AOF，因为AOF在数据恢复时，有时候会出现Bugs。</li>
</ul>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-8">
                                        <div class="post-content" data-content-type="full">
                                            <h2 id="Redis的持久化机制-RDB">Redis的持久化机制-RDB</h2>
<h3 id="1-什么是RDB">1.什么是RDB</h3>
<p>The RDB persistence performs point-in-time snapshots of your dataset at specified intervals.(RDB持久化是以指定的时间间隔执行数据集的时间点快照。)<br>
简单来说，RDB是每隔一段时间，会把内存中的数据写入磁盘的临时文件作为快照，恢复时把快照文件读取到内存中。如果机器宕机，那么内存中的数据就会丢失，使用RDB机制后，重启后数据会恢复。</p>
<h3 id="2-备份与恢复">2.备份与恢复</h3>
<p>内存备份 --&gt; <font color="#e58484">磁盘临时文件</font><br>
临时文件 --&gt; <font color="#e58484">恢复到内存</font></p>
<h3 id="3-RDB优劣势">3.RDB优劣势</h3>
<ul>
<li>
<p><strong>优势</strong></p>
<ol>
<li>每隔一段时间全量备份</li>
<li>容灾简单，适合进行远程冷备份</li>
<li>子进程备份的时候，主进程不会有任何IO操作（不会有写入或修改），保证备份数据的完整性</li>
<li>相对AOF来说，当有更大的文件时候可以快速重启恢复</li>
</ol>
</li>
<li>
<p><strong>劣势</strong></p>
<ol>
<li>发生故障时，可能会丢失最后一次备份数据</li>
<li>子进程所占用的内存会和父进程一模一样，会造成CPU负担</li>
<li>由于定时全量备份是重量级操作，所以对于实时备份，就无法处理了</li>
</ol>
</li>
</ul>
<h3 id="4-RDB的配置">4.RDB的配置</h3>
<ol>
<li>保存位置可以自定义配置:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir /var/redis/6379/dump.rdb</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>保存机制</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#   900秒（15分钟）后，如果至少有 1 个Key发生改变</span><br><span class="line">#   300秒（5分钟）后，如果至少有 10 个Key发生改变</span><br><span class="line">#   60秒（1分钟）后，如果至少有 10000 个Key发生改变</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
<h2 id="Redis的持久化机制-AOF">Redis的持久化机制-AOF</h2>
<h3 id="1-什么是AOF">1.什么是AOF</h3>
<p>The AOF persistence logs every write operation received by the server, that will be played again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself, in an append-only fashion. Redis is able to rewrite the log in the background when it gets too big.</p>
<p>AOF持久化会记录服务器接收到的每个写入操作，这些操作将在服务器启动时再次执行，以重新构建原始的数据。命令记录的格式与Redis协议本身的格式相同，采用追加方式。当日志文件过大时，Redis可以在后台进行<code>rewrite</code>。</p>
<h3 id="2-备份与恢复-v2">2.备份与恢复</h3>
<p>日志备份 --&gt; <font color="#e58484">命令追加方式</font><br>
日志文件 --&gt; <font color="#e58484">根据命令日志文件重新构建</font></p>
<h3 id="3-AOF优劣势">3.AOF优劣势</h3>
<ul>
<li><strong>优势</strong>
<ol>
<li>使用AOF数据持久化更加完整</li>
<li>可以使用不同的fsync策略，使用默认策略fsync时，每秒的写入性能仍然很好（fsync是使用后台线程执行的，并且在没有进行fsync的情况下，主线程将尽力执行写入操作）但是会损失一秒的写入时间</li>
<li>AOF是使用日志追加的方式，如果断电或其他原因导致日志只写了一半，可以使用<code>redis-check-aof</code>工具进行修复</li>
<li>Redis太大时，Redis可以在后台自动重写AOF。 Redis继续追加到旧文件时，会生成一个新的文件，其中包含创建当前数据集<strong>所需的最少操作集</strong>，一旦准备好第二个文件，Redis会切换这两个文件并开始追加到新的那一个</li>
<li>即使使用<code>FLUSHALL</code>命令清空了所有数据，也可以通过修改AOF文件进行数据恢复</li>
</ol>
</li>
<li><strong>劣势</strong>
<ol>
<li>AOF相比RDB占用空间更大</li>
<li>使用fsync策略后，相比RDB性能差一些</li>
<li>当服务器宕机后，使用AOF恢复的数据可能不完整</li>
</ol>
</li>
</ul>
<h3 id="4-AOF的配置">4.AOF的配置</h3>
<ol>
<li>开启AOF</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>配置fsync策略</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># If unsure, use &quot;everysec&quot;.</span><br><span class="line"># 如果不确定，推荐使用 &quot;everysec&quot;</span><br><span class="line"></span><br><span class="line"># appendfsync always</span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync no</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>AOF rewrite配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 设置一个百分比</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"># 设置AOF 的最小大小</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Redis 启动加载配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 优先加载AOF 文件</span><br><span class="line">aof-use-rdb-preamble yes</span><br></pre></td></tr></table></figure>
<h2 id="两种持久化方式改如何选择">两种持久化方式改如何选择</h2>
<ul>
<li>如果对数据可靠性要求很高，则应同时使用两种持久性方式。</li>
<li>如果在灾难情况下仍然可以承受几分钟的数据丢失，则可以仅使用RDB。</li>
<li>不推荐单独使用AOF，因为AOF在数据恢复时，有时候会出现Bugs。</li>
</ul>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2018-07-06T14:56:00.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2018-07-06
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/Redis/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                Redis
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="8" id="btn-8">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
            <article class="bg-white dark:bg-gray-800 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300 border border-gray-200 dark:border-gray-700">
                <div class="flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold mb-3">
                            <a href="/2018/07/06/Redis%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/" class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                Redis安装与配置
                            </a>
                        </h3>
                        
                        
                        
                        
                            <div class="post-content-container mb-4">
                                <div class="post-content-preview text-gray-600 dark:text-gray-300 leading-relaxed" id="preview-9">
                                    <div class="post-content-preview-wrapper">
                                        <div class="post-content" data-content-type="preview">
                                            <h3 id="下载">下载</h3>
<ol>
<li>从<a href="http://www.redis.io">Redis官网</a>下载redis 最新稳定版本</li>
<li>解压到 /usr/local/ 目录下</li>
</ol>
<h3 id="安装">安装</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make test &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>make时报如下错误:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory</span><br><span class="line">zmalloc.h:55:2: error: #error &quot;Newer version of jemalloc required&quot;</span><br><span class="line">make[1]: *** [adlist.o] Error 1</span><br><span class="line">make[1]: Leaving directory `/data0/src/redis-2.6.2/src&#x27;</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure>
<p>原因是jemalloc重载了Linux下的ANSI C的malloc和free函数。<br>
解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make MALLOC=libc</span><br></pre></td></tr></table></figure>
<h3 id="redis-生产环境启动方案">redis 生产环境启动方案</h3>
<ol>
<li>redis utils 目录下，有个redis_init_script脚本</li>
<li>将redis_init_script脚本拷贝到linux的/etc/init.d 目录中，将redis_init_script重命名为redis_6379,   6379是我们希望redis 的实例端口号</li>
<li>创建两个目录 /etc/redis (存放redis 配置的目录), /var/redis/6379 (存放redis的持久文件)</li>
<li>修改redis.conf配置文件（默认在根目录下），拷贝到/etc/redis目录下，修改名称为6379.conf</li>
<li>修改redis.conf中的部分配置为生产环境</li>
</ol>
<table>
<thead>
<tr>
<th>参数</th>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>daemonize</td>
<td>yes</td>
<td>让redis以daemon进程运行</td>
</tr>
<tr>
<td>pidfile</td>
<td>/var/run/redis_6379.pid</td>
<td>设置redis的pid文件位置</td>
</tr>
<tr>
<td>port</td>
<td>6379</td>
<td>设置redis的监听端口号</td>
</tr>
<tr>
<td>dir</td>
<td>/var/redis/6379</td>
<td>设置持久化文件的存储位置</td>
</tr>
</tbody>
</table>
<ol start="6">
<li>启动redis:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/init.d </span><br><span class="line">chmod 777 redis_6379 </span><br><span class="line">./redis_6379 start</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>确认redis 进程是否启动: <code>ps -ef  |  grep redis</code></li>
<li>让redis跟随系统启动自动启动，在redis_6379 脚本中，最上面加入两行注释</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># chkconfig:    2345 90 10</span><br><span class="line"># description: Redis is a persistent key-value database</span><br><span class="line">chkconfig redis_6379 on   </span><br></pre></td></tr></table></figure>
<h3 id="主从架构（主节点和从节点最好保证一致的版本）">主从架构（主节点和从节点最好保证一致的版本）</h3>
<ol>
<li>在 slave node 上配置:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 192.168.1.1 6379</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>强制读写分离</li>
</ol>
<p>基于主从复制架构，实现读写分离<br>
redis slave node 只读，默认开启，<code>slave-read-only</code><br>
开启了只读的redis slave node，会拒绝所有的写操作，这样可以强制搭建成读写分离架构</p>
<ol start="3">
<li>
<p>集成安全认证<br>
master 上启用安全认证策略，<code>requirepass</code><br>
master 连接口令 <code>masterauth</code></p>
</li>
<li>
<p>读写分离架构的测试<br>
先启动主节点，再启动从节点，在搭建生产环境的时候，不要忘记修改一个配置：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1</span><br></pre></td></tr></table></figure>
<p>每个redis.conf 中的bind <code>127.0.0.1</code> -&gt; bind自己的ip，并且防火墙打开6379端口</p>
<h3 id="redis-cli的使用">redis-cli的使用</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>redis-cli shutdown</td>
<td>连接本机的6379端口停止redis进程</td>
</tr>
<tr>
<td>redis-cli -h 127.0.0.1 -p 6379</td>
<td>指定要连接的ip和端口号</td>
</tr>
<tr>
<td>redis-cli ping</td>
<td>ping redis的端口，看是否正常</td>
</tr>
<tr>
<td>redis-cli</td>
<td>进入交互式命令行</td>
</tr>
<tr>
<td>set k1 v1</td>
<td>设置一个key:value</td>
</tr>
<tr>
<td>get k1</td>
<td>获取key的值</td>
</tr>
</tbody>
</table>

                                        </div>
                                    </div>
                                    
                                        <div class="content-fade"></div>
                                    
                                </div>
                                
                                    <div class="post-content-full text-gray-600 dark:text-gray-300 leading-relaxed post-hidden" id="full-9">
                                        <div class="post-content" data-content-type="full">
                                            <h3 id="下载">下载</h3>
<ol>
<li>从<a href="http://www.redis.io">Redis官网</a>下载redis 最新稳定版本</li>
<li>解压到 /usr/local/ 目录下</li>
</ol>
<h3 id="安装">安装</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make test &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>make时报如下错误:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory</span><br><span class="line">zmalloc.h:55:2: error: #error &quot;Newer version of jemalloc required&quot;</span><br><span class="line">make[1]: *** [adlist.o] Error 1</span><br><span class="line">make[1]: Leaving directory `/data0/src/redis-2.6.2/src&#x27;</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure>
<p>原因是jemalloc重载了Linux下的ANSI C的malloc和free函数。<br>
解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make MALLOC=libc</span><br></pre></td></tr></table></figure>
<h3 id="redis-生产环境启动方案">redis 生产环境启动方案</h3>
<ol>
<li>redis utils 目录下，有个redis_init_script脚本</li>
<li>将redis_init_script脚本拷贝到linux的/etc/init.d 目录中，将redis_init_script重命名为redis_6379,   6379是我们希望redis 的实例端口号</li>
<li>创建两个目录 /etc/redis (存放redis 配置的目录), /var/redis/6379 (存放redis的持久文件)</li>
<li>修改redis.conf配置文件（默认在根目录下），拷贝到/etc/redis目录下，修改名称为6379.conf</li>
<li>修改redis.conf中的部分配置为生产环境</li>
</ol>
<table>
<thead>
<tr>
<th>参数</th>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>daemonize</td>
<td>yes</td>
<td>让redis以daemon进程运行</td>
</tr>
<tr>
<td>pidfile</td>
<td>/var/run/redis_6379.pid</td>
<td>设置redis的pid文件位置</td>
</tr>
<tr>
<td>port</td>
<td>6379</td>
<td>设置redis的监听端口号</td>
</tr>
<tr>
<td>dir</td>
<td>/var/redis/6379</td>
<td>设置持久化文件的存储位置</td>
</tr>
</tbody>
</table>
<ol start="6">
<li>启动redis:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/init.d </span><br><span class="line">chmod 777 redis_6379 </span><br><span class="line">./redis_6379 start</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>确认redis 进程是否启动: <code>ps -ef  |  grep redis</code></li>
<li>让redis跟随系统启动自动启动，在redis_6379 脚本中，最上面加入两行注释</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># chkconfig:    2345 90 10</span><br><span class="line"># description: Redis is a persistent key-value database</span><br><span class="line">chkconfig redis_6379 on   </span><br></pre></td></tr></table></figure>
<h3 id="主从架构（主节点和从节点最好保证一致的版本）">主从架构（主节点和从节点最好保证一致的版本）</h3>
<ol>
<li>在 slave node 上配置:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 192.168.1.1 6379</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>强制读写分离</li>
</ol>
<p>基于主从复制架构，实现读写分离<br>
redis slave node 只读，默认开启，<code>slave-read-only</code><br>
开启了只读的redis slave node，会拒绝所有的写操作，这样可以强制搭建成读写分离架构</p>
<ol start="3">
<li>
<p>集成安全认证<br>
master 上启用安全认证策略，<code>requirepass</code><br>
master 连接口令 <code>masterauth</code></p>
</li>
<li>
<p>读写分离架构的测试<br>
先启动主节点，再启动从节点，在搭建生产环境的时候，不要忘记修改一个配置：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1</span><br></pre></td></tr></table></figure>
<p>每个redis.conf 中的bind <code>127.0.0.1</code> -&gt; bind自己的ip，并且防火墙打开6379端口</p>
<h3 id="redis-cli的使用">redis-cli的使用</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>redis-cli shutdown</td>
<td>连接本机的6379端口停止redis进程</td>
</tr>
<tr>
<td>redis-cli -h 127.0.0.1 -p 6379</td>
<td>指定要连接的ip和端口号</td>
</tr>
<tr>
<td>redis-cli ping</td>
<td>ping redis的端口，看是否正常</td>
</tr>
<tr>
<td>redis-cli</td>
<td>进入交互式命令行</td>
</tr>
<tr>
<td>set k1 v1</td>
<td>设置一个key:value</td>
</tr>
<tr>
<td>get k1</td>
<td>获取key的值</td>
</tr>
</tbody>
</table>

                                        </div>
                                    </div>
                                
                            </div>
                        
                        
                        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex items-center space-x-4">
                                <time datetime="2018-07-06T14:22:42.000Z" class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"></path></svg>
                                    2018-07-06
                                </time>
                                
                                
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
                                        
                                            <a href="/categories/Redis/" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                                Redis
                                            </a>
                                        
                                    </div>
                                
                            </div>
                            
                            
                                <button class="expand-btn flex text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 font-medium items-center transition-colors text-sm" data-index="9" id="btn-9">
                                    <span class="expand-text">显示更多</span>
                                    <svg class="w-4 h-4 ml-1 expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                                </button>
                            
                        </div>
                    </div>
                </div>
            </article>
        
    </div>
    
    <!-- 分页 -->
    
        <nav class="flex justify-center mt-12">
            <div class="flex items-center space-x-2">
                
                    <a href="/page/4/" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg>
                        上一页
                    </a>
                
                
                <span class="px-4 py-2 bg-primary-600 text-white rounded-lg font-medium">
                    5 / 6
                </span>
                
                
                    <a href="/page/6/" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center">
                        下一页
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg>
                    </a>
                
            </div>
        </nav>
    
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 绑定"显示更多"按钮事件
    document.querySelectorAll('.expand-btn').forEach(button => {
        button.addEventListener('click', function() {
            const index = this.getAttribute('data-index');
            toggleContent(index);
        });
    });
});

function toggleContent(index) {
    const preview = document.getElementById('preview-' + index);
    const full = document.getElementById('full-' + index);
    const btn = document.getElementById('btn-' + index);
    const expandText = btn.querySelector('.expand-text');
    const expandIcon = btn.querySelector('.expand-icon');

    if (full.classList.contains('post-hidden')) {
        // 展开内容
        preview.classList.add('post-hidden');
        full.classList.remove('post-hidden');
        full.classList.add('post-visible');
        expandText.textContent = '收起';
        expandIcon.style.transform = 'rotate(180deg)';
    } else {
        // 折叠内容
        preview.classList.remove('post-hidden');
        full.classList.add('post-hidden');
        full.classList.remove('post-visible');
        expandText.textContent = '显示更多';
        expandIcon.style.transform = 'rotate(0deg)';
    }
}
</script>

<style>
.expand-icon {
    transition: transform 0.3s ease;
}
.post-content-preview {
    position: relative;
}
.post-content-preview-wrapper {
    max-height: 300px;
    overflow: hidden;
    position: relative;
}
.content-fade {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100px;
    background: linear-gradient(to bottom, transparent, rgb(255 255 255 / 100%));
    pointer-events: none;
}
.dark .content-fade {
    background: linear-gradient(to bottom, transparent, rgb(31 41 55 / 100%));
}
.post-hidden {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: all 0.3s ease;
}

.post-visible {
    max-height: none;
    opacity: 1;
}
</style>

                                    </div>
                                </div>

                                
                                    <!-- 侧边栏 - 仅在非文章页显示 -->
                                    <aside class="main-sidebar hidden lg:block lg:w-72 xl:w-80 flex-shrink-0">
                                        <div class="space-y-6">
	<!-- 个人信息卡片 -->
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 text-center border border-gray-200 dark:border-gray-700">
		<div class="mb-4">
			
			<div class="relative inline-block">
				<img class="w-20 h-20 rounded-full mx-auto object-cover border-4 border-primary-100 dark:border-primary-800" 
					 src="/img/avatar.jpg" 
					 alt="KIM">
			</div>
			
		</div>
		
		<h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
			KIM
		</h3>
		
		
		<p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
			stay hungry , stay foolish 
		</p>
		
		
		<!-- 社交链接 -->
		
	</div>

	<!-- 搜索框 -->
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-700">
		<h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
			<svg class="w-4 h-4 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>
			搜索
		</h4>
		<div class="relative">
			<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
				<svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>
			</div>
			<input type="text" 
				   placeholder="请输入关键词搜索..." 
				   class="w-full pl-8 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
				   onclick="window.location.href='/search/'">
		</div>
	</div>

	<!-- 最近文章 -->
	
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-700">
		<h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
			<svg class="w-4 h-4 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"></path></svg>
			最近文章
		</h4>
		<ul class="space-y-2">
			
			<li>
				<a href="/2025/06/11/mermaid/" 
				   class="block text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors line-clamp-2">
					mermaid
				</a>
				<time class="text-xs text-gray-400 dark:text-gray-500">
					06-11
				</time>
			</li>
			
			<li>
				<a href="/2025/01/01/2025%E6%91%98%E6%8A%84/" 
				   class="block text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors line-clamp-2">
					2025摘抄
				</a>
				<time class="text-xs text-gray-400 dark:text-gray-500">
					01-01
				</time>
			</li>
			
			<li>
				<a href="/2024/12/31/2024%E6%91%98%E6%8A%84/" 
				   class="block text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors line-clamp-2">
					2024摘抄
				</a>
				<time class="text-xs text-gray-400 dark:text-gray-500">
					12-31
				</time>
			</li>
			
			<li>
				<a href="/2022/06/12/%E4%BA%8B%E5%8A%A1%E5%88%B0%E5%BA%95%E6%98%AF%E9%9A%94%E7%A6%BB%E7%9A%84%E8%BF%98%E6%98%AF%E4%B8%8D%E9%9A%94%E7%A6%BB%E7%9A%84%EF%BC%9F/" 
				   class="block text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors line-clamp-2">
					事务到底是隔离的还是不隔离的？
				</a>
				<time class="text-xs text-gray-400 dark:text-gray-500">
					06-12
				</time>
			</li>
			
			<li>
				<a href="/2022/06/12/%E8%A1%8C%E9%94%81%E5%8A%9F%E8%BF%87%EF%BC%9A%E6%80%8E%E4%B9%88%E5%87%8F%E5%B0%91%E8%A1%8C%E9%94%81%E5%AF%B9%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D%EF%BC%9F/" 
				   class="block text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors line-clamp-2">
					行锁功过：怎么减少行锁对性能的影响？
				</a>
				<time class="text-xs text-gray-400 dark:text-gray-500">
					06-12
				</time>
			</li>
			
		</ul>
	</div>
	

	<!-- 分类 -->
	
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-700">
		<h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
			<svg class="w-4 h-4 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
			分类
		</h4>
		<div class="space-y-1">
			
			<a href="/categories/Git/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>Git</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					6
				</span>
			</a>
			
			<a href="/categories/Java/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>Java</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					3
				</span>
			</a>
			
			<a href="/categories/Linux/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>Linux</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/MySQL/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>MySQL</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/categories/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>MySQL实战45讲</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					7
				</span>
			</a>
			
			<a href="/categories/Netty/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>Netty</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/Nginx/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>Nginx</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/Redis/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>Redis</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					5
				</span>
			</a>
			
			<a href="/categories/RocketMQ/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>RocketMQ</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/categories/Tomcat/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>Tomcat</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/ddia/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>ddia</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/docker/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>docker</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/go/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>go</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/golang/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>golang</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/mermiad/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>mermiad</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/nginx/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>nginx</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/prometheus/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>prometheus</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/%E4%BA%BA%E7%94%9F/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>人生</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/%E5%85%B6%E4%BB%96/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>其他</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>多线程</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/%E5%AD%A6%E4%B9%A0/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>学习</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/%E5%B7%A5%E4%BD%9C/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>工作</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/%E6%91%98%E6%8A%84/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>摘抄</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%B5%8B%E8%AF%95%E8%AF%BE/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>程序员的测试课</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/categories/%E7%AE%97%E6%B3%95/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>算法</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					3
				</span>
			</a>
			
			<a href="/categories/%E8%AF%BB%E4%B9%A6/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>读书</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					3
				</span>
			</a>
			
			<a href="/categories/%E9%9A%8F%E6%89%8B%E8%AE%B0/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>随手记</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
		</div>
	</div>
	

	<!-- 标签云 -->
	
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-700">
		<h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
			<svg class="w-4 h-4 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6h.008v.008H6V6Z"></path></svg>
			标签
		</h4>
		<div class="flex flex-wrap gap-2">
			
			<a href="/tags/Git/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				Git
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					6
				</span>
			</a>
			
			<a href="/tags/Java/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				Java
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					4
				</span>
			</a>
			
			<a href="/tags/Linux/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				Linux
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/MySQL/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				MySQL
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					9
				</span>
			</a>
			
			<a href="/tags/Netty/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				Netty
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/Nginx/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				Nginx
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/Redis/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				Redis
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					6
				</span>
			</a>
			
			<a href="/tags/RocketMQ/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				RocketMQ
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					2
				</span>
			</a>
			
			<a href="/tags/String/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				String
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/Tomcat/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				Tomcat
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/docker/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				docker
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/go/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				go
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/golang/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				golang
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/hexo/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				hexo
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/juc/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				juc
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/mermaid/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				mermaid
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/nginx/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				nginx
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/prometheus/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				prometheus
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E4%BA%BA%E7%94%9F/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				人生
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E5%85%B6%E4%BB%96/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				其他
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				分布式
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				分布式锁
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				多线程
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E5%AD%A6%E4%B9%A0/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				学习
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E6%91%98%E6%8A%84/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				摘抄
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					2
				</span>
			</a>
			
			<a href="/tags/%E6%B5%8B%E8%AF%95/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				测试
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E7%AE%97%E6%B3%95/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				算法
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					3
				</span>
			</a>
			
			<a href="/tags/%E7%BF%BB%E8%AF%91/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				翻译
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E8%AF%BB%E4%B9%A6/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				读书
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					2
				</span>
			</a>
			
			<a href="/tags/%E8%BD%AC%E8%BD%BD/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				转载
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					2
				</span>
			</a>
			
			<a href="/tags/%E8%BF%90%E7%BB%B4/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				运维
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
			<a href="/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/" 
			   class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
				随手记
				<span class="ml-1 text-primary-600 dark:text-primary-300">
					1
				</span>
			</a>
			
		</div>
	</div>
	

	<!-- 归档 -->
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-700">
		<h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
			<svg class="w-4 h-4 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"></path></svg>
			归档
		</h4>
		<div class="space-y-1">
			
			<a href="/archives/2025/06/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2025年06月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2025/01/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2025年01月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2024/12/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2024年12月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2022/06/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2022年06月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					7
				</span>
			</a>
			
			<a href="/archives/2022/05/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2022年05月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/archives/2022/04/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2022年04月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					3
				</span>
			</a>
			
			<a href="/archives/2022/02/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2022年02月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/archives/2021/09/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2021年09月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2021/04/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2021年04月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					4
				</span>
			</a>
			
			<a href="/archives/2021/03/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2021年03月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					8
				</span>
			</a>
			
			<a href="/archives/2021/01/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2021年01月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2020/10/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2020年10月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/archives/2020/09/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2020年09月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2020/08/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2020年08月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					3
				</span>
			</a>
			
			<a href="/archives/2020/07/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2020年07月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/archives/2020/05/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2020年05月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					2
				</span>
			</a>
			
			<a href="/archives/2019/09/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2019年09月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					3
				</span>
			</a>
			
			<a href="/archives/2019/08/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2019年08月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2019/02/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2019年02月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2019/01/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2019年01月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
			<a href="/archives/2018/07/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2018年07月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					3
				</span>
			</a>
			
			<a href="/archives/2018/06/" 
			   class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors py-1">
				<span>2018年06月</span>
				<span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">
					1
				</span>
			</a>
			
		</div>
	</div>
</div>
                                    </aside>
                                    
                            </div>
                        </div>
                    </main>

                    <!-- 页脚 -->
                    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center">
            <p class="text-gray-600 dark:text-gray-400 mb-2">
                无常是常 @ All Rights Reserved 2025
            </p>
            
                <p class="text-gray-500 dark:text-gray-500 text-sm"><a href="https://beian.miit.gov.cn" target="_blank">陕ICP备16008414号-1</a></p>
                
        </div>
    </div>
</footer>

<!-- 回到顶部按钮 -->
<button id="back-to-top"
    class="fixed bottom-8 right-8 bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 opacity-0 invisible z-50">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"></path></svg>
</button>
            </div>
        </body>
        <!-- JavaScript -->
        <script src="/js/plugins.js" defer></script>
        <!-- Mermaid 支持 -->
        
            <script src="/js/mermaid.min.js"></script>
            <script defer>
                window.addEventListener('load', function () {
                    // 初始化 Mermaid 并让其自动渲染
                    mermaid.initialize({
                        theme: 'default',
                        startOnLoad: true, // 启用自动渲染
                        securityLevel: 'loose',

                        // 为各个图表类型配置自适应宽度
                        flowchart: {
                            htmlLabels: 'true',
                            curve: 'linear',
                            useMaxWidth: true
                        },
                        sequence: {
                            diagramMarginX: '50',
                            diagramMarginY: '10',
                            actorMargin: '50',
                            width: '150',
                            height: '65',
                            boxMargin: '10',
                            boxTextMargin: '5',
                            noteMargin: '10',
                            messageMargin: '35',
                            mirrorActors: 'true',
                            bottomMarginAdj: '1',
                            useMaxWidth: true
                        },
                        class: {
                            useMaxWidth: true
                        },
                        state: {
                            useMaxWidth: true
                        },
                        gantt: {
                            useMaxWidth: true
                        },
                        journey: {
                            useMaxWidth: true
                        }
                    });
                });
            </script>

            <!-- Mermaid 样式 -->
            <style>
                .mermaid {
                    text-align: center;
                    margin: 1.5em 0;
                    padding: 1rem;
                    background: #f8f9fa;
                    border-radius: 0.5rem;
                    border: 1px solid #e9ecef;
                    overflow-x: auto;
                    overflow-y: visible;
                    max-width: 100%;
                    box-sizing: border-box;
                }

                .mermaid-rendered {
                    background: transparent;
                    border: none;
                    padding: 0;
                }

                .mermaid-error {
                    color: #dc3545;
                    background-color: #f8d7da;
                    border: 1px solid #f5c6cb;
                    border-radius: 0.375rem;
                    padding: 0.75rem;
                    margin: 1rem 0;
                    font-family: monospace;
                    text-align: left;
                }

                /* 深色模式下的 Mermaid 样式 */
                .dark .mermaid {
                    background: #374151;
                    border-color: #4b5563;
                }

                .dark .mermaid-error {
                    color: #f8d7da;
                    background-color: #2d1b1e;
                    border-color: #842029;
                }

                /* 确保 Mermaid 图表在深색模式下可见 */
                .dark .mermaid svg {
                    background-color: transparent;
                }

                /* Mermaid 图表样式优化 */
                .mermaid svg {
                    max-width: 100%;
                    height: auto;
                    display: block;
                    margin: 0 auto;
                    /* 保持原始比例，但不超过容器 */
                    width: auto;
                }

                /* Mermaid 图表容器已在上面定义，这里添加额外的响应式处理 */

                /* 针对大型图表的滚动条样式 */
                .mermaid::-webkit-scrollbar {
                    height: 8px;
                }

                .mermaid::-webkit-scrollbar-track {
                    background: #f1f1f1;
                    border-radius: 4px;
                }

                .mermaid::-webkit-scrollbar-thumb {
                    background: #c1c1c1;
                    border-radius: 4px;
                }

                .mermaid::-webkit-scrollbar-thumb:hover {
                    background: #a8a8a8;
                }

                /* 深色模式下的滚动条 */
                .dark .mermaid::-webkit-scrollbar-track {
                    background: #4b5563;
                }

                .dark .mermaid::-webkit-scrollbar-thumb {
                    background: #6b7280;
                }

                .dark .mermaid::-webkit-scrollbar-thumb:hover {
                    background: #9ca3af;
                }
            </style>
            

</html>