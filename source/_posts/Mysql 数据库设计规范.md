---
title: Mysql 数据库设计规范
date: 2018-08-28 09:37:18
tags: mysql
categories: mysql
---
### 一、事务的基本要素（ACID）

　　 1、**原子性（Atomicity）**：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。

　　 2、**一致性（Consistency）**：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。

　　 3、**隔离性（Isolation）**：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。

　　 4、**持久性（Durability）**：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。

### 二、事务的隔离性（Isolation）  

**SQL 中定义的四种隔离级别**  

- 未提交读（read uncommitted）  
- 已提交读（read committed）
- 可重复读（repeatable read）
- 可串行化（serializable）  

**mysql默认的事务隔离级别为repeatable read**  

### 三、索引设计规范

**每个Innodb表必须有一个主键**
1. 不使用更新频繁的列作为主键，不使用多列主键

2. 不使用UUID、MD5、HASH、字符串列作为主键

3. 主键建议选择自增ID  

**常见索引建议**  
`SELECT、UPDATE、DELETE`语句的`WHERE`从句中的列包含`ORDER BY、GROUP BY、DISTICNT`中的字段和多表`JOIN`的关联列  

**如何选择索引的顺序**  
1. 区分度最高的列放在联合索引的最左侧  

2. 尽量把字段长度小的列放在联合索引的最左侧  

3. 使用最频繁的列放在联合索引的最左侧  

**尽量避免使用外键**  
1. 外键可用于保证数据的参照完整性，但建议业务端实现

2. 外键会影响父表和子表的写操作从而性能降低

### 四、数据库字段设计规范  

**优先选择符合存储需要的最小数据类型**  
1. 将字符串转换为数字存储类型
```
    INET_ATON('255.255.255.255') = 4294967295
    INET_NTOA(4294967295) = '255.255.255.255'
```
2. 对于非负数据采用无符号整型进行存储
```
    SIGNED INT -2147483648 ~ 2147483647
    UNSIGNED INT 0 ~ 4294967295 
```

3. **VARCHAR(N)** 中的**N**代表的是字符数，而不是字节数。使用UTF8存储汉字VARCHAR(255) = 765 个字节，过大的长度会消耗更多的内存。

4. 避免使用**TEXT、BLOB**数据类型，建议把BLOB或TEXT列分离到单独的扩展表中。TEXT或BLOB类型只能使用**前缀索引**。

5. 避免使用**ENUM**数据类型，修改ENUM值需要使用**ALTER**语句。ENUM类型的**ORDER BY**操作效率低，需要额外操作，**禁止**使用数值作为ENUM的枚举值。

6. 尽可能把所有列定义为**NOT NULL**，索引NULL列需要额外的空间来保存，所以要占更多的空间。进行比较和计算时要对NULL值做特殊的处理。

7. 字符串存储日期型的数据（**不正确的做法**）  
**缺点1：无法用日期函数进行计算和比较**  
**缺点2：用字符串存储日期要占用更多的空间**  
**注意：Timestamp 占四个字节 DateTime 占八个字节。**

>**DateTime 以'YYYY-MM-DD HH:MM:SS'格式检索和显示DATETIME值。支持的范围为'1000-01-01 00:00:00'到'9999-12-31 23:59:59'**   
>**Timestamp值不能早于1970或晚于2037**

8. 非精准浮点类型：**float、double**,精准浮点类型：**decimal**  
**财务相关的金额类数据，必须使用decimal类型**  
Decimal类型为精准浮点数，在计算时不会丢失精度，占用空间由自定义的宽度决定，可用于存储比`bigint`更大的整数数据。
