<footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center">
            <p class="text-gray-600 dark:text-gray-400 mb-2"><%= theme.footer %></p>
            <% if (theme.beian) { %>
            <p class="text-gray-500 dark:text-gray-500 text-sm"><%- theme.beian %></p>
            <% } %>
        </div>
    </div>
</footer>

<!-- 回到顶部按钮 -->
<button id="back-to-top" class="fixed bottom-8 right-8 bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 opacity-0 invisible z-50">
    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
    </svg>
</button>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 深色模式切换
    const themeToggle = document.getElementById('theme-toggle');
    const darkIcon = document.getElementById('theme-toggle-dark-icon');
    const lightIcon = document.getElementById('theme-toggle-light-icon');
    
    // 初始化图标显示
    function updateThemeIcons() {
        if (document.documentElement.classList.contains('dark')) {
            darkIcon.classList.add('hidden');
            lightIcon.classList.remove('hidden');
        } else {
            darkIcon.classList.remove('hidden');
            lightIcon.classList.add('hidden');
        }
    }
    
    updateThemeIcons();
    
    if (themeToggle) {
        themeToggle.addEventListener('click', function() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
            updateThemeIcons();
        });
    }
    
    // 移动端菜单切换
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function() {
            mobileMenu.classList.toggle('hidden');
        });
    }
    
    // 回到顶部按钮
    const backToTopButton = document.getElementById('back-to-top');
    
    if (backToTopButton) {
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopButton.classList.remove('opacity-0', 'invisible');
                backToTopButton.classList.add('opacity-100', 'visible');
            } else {
                backToTopButton.classList.add('opacity-0', 'invisible');
                backToTopButton.classList.remove('opacity-100', 'visible');
            }
        });
        
        backToTopButton.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }
});
</script>

<!-- 现代代码块系统 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 初始化所有代码块 - 处理Hexo的figure.highlight结构
    document.querySelectorAll('figure.highlight').forEach(function(figure, index) {
        // 创建代码块容器
        const codeContainer = document.createElement('div');
        codeContainer.className = 'modern-code-block';
        
        // 获取语言信息
        const language = getLanguageFromClass(figure.className) || 'text';
        
        // 创建头部
        const header = document.createElement('div');
        header.className = 'code-header';
        header.innerHTML = `
            <div class="code-language">${getLanguageDisplay(language)}</div>
            <button class="code-copy-btn" data-index="${index}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                </svg>
                <span>复制</span>
            </button>
        `;
        
        // 创建代码内容区域
        const codeContent = document.createElement('div');
        codeContent.className = 'code-content';
        
        // 处理代码内容 - 从Hexo的table结构中提取
        const codeLineElements = figure.querySelectorAll('td.code .line');
        const lines = Array.from(codeLineElements).map(line => line.textContent);
        const codeText = lines.join('\n');
        
        // 创建行号和代码行
        const lineNumbers = document.createElement('div');
        lineNumbers.className = 'line-numbers';
        
        const codeLinesContainer = document.createElement('div');
        codeLinesContainer.className = 'code-lines';
        
        lines.forEach((line, lineIndex) => {
            if (lineIndex === lines.length - 1 && line === '') return; // 跳过最后的空行
            
            // 行号
            const lineNumber = document.createElement('div');
            lineNumber.className = 'line-number';
            lineNumber.textContent = lineIndex + 1;
            lineNumbers.appendChild(lineNumber);
            
            // 代码行
            const codeLine = document.createElement('div');
            codeLine.className = 'code-line';
            codeLine.textContent = line || ' '; // 空行显示空格
            codeLinesContainer.appendChild(codeLine);
        });
        
        codeContent.appendChild(lineNumbers);
        codeContent.appendChild(codeLinesContainer);
        
        // 组装代码块
        codeContainer.appendChild(header);
        codeContainer.appendChild(codeContent);
        
        // 替换原始代码块
        figure.parentNode.replaceChild(codeContainer, figure);
        
        // 添加复制功能
        const copyBtn = codeContainer.querySelector('.code-copy-btn');
        copyBtn.addEventListener('click', function() {
            const textToCopy = codeText;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(function() {
                    showCopySuccess(copyBtn);
                });
            } else {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopySuccess(copyBtn);
            }
        });
    });
    
    function getLanguageFromClass(className) {
        if (!className) return null;
        // Hexo使用 highlight 后跟语言名称的格式
        const match = className.match(/highlight\s+(\w+)/);
        return match ? match[1] : null;
    }
    
    function getLanguageDisplay(lang) {
        const langMap = {
            'javascript': 'JavaScript',
            'js': 'JavaScript',
            'typescript': 'TypeScript',
            'ts': 'TypeScript',
            'python': 'Python',
            'py': 'Python',
            'java': 'Java',
            'cpp': 'C++',
            'c': 'C',
            'csharp': 'C#',
            'cs': 'C#',
            'html': 'HTML',
            'css': 'CSS',
            'scss': 'SCSS',
            'sass': 'Sass',
            'json': 'JSON',
            'xml': 'XML',
            'yaml': 'YAML',
            'yml': 'YAML',
            'sql': 'SQL',
            'bash': 'Bash',
            'shell': 'Shell',
            'sh': 'Shell',
            'powershell': 'PowerShell',
            'ps1': 'PowerShell',
            'go': 'Go',
            'rust': 'Rust',
            'php': 'PHP',
            'ruby': 'Ruby',
            'swift': 'Swift',
            'kotlin': 'Kotlin',
            'dart': 'Dart',
            'text': 'Text',
            'txt': 'Text'
        };
        return langMap[lang.toLowerCase()] || lang.toUpperCase();
    }
    
    function showCopySuccess(button) {
        const span = button.querySelector('span');
        const originalText = span.textContent;
        span.textContent = '已复制!';
        button.classList.add('copied');
        
        setTimeout(function() {
            span.textContent = originalText;
            button.classList.remove('copied');
        }, 2000);
    }
});
</script>
